/*
  knockback-core.js
  (c) 2011-2014 Kevin Malakoff.
  Knockback is freely distributable under the MIT license.
  See the following for full license details:
    https://github.com/kmalakoff/knockback/blob/master/LICENSE
  Dependencies: Knockout.js, Backbone.js, and Underscore.js.
    Optional dependency: Backbone.ModelRef.js.
*/
(function(){var e={requires:[]};window.require&&e.requires.push(window.require),"undefined"!=typeof t&&null!==t&&e.requires.push(t),function(){"use strict";var t={},r={},n=function(e,t){return{}.hasOwnProperty.call(e,t)},o=function(e,t){var r,n,o=[];r=/^\.\.?(\/|$)/.test(t)?[e,t].join("/").split("/"):t.split("/");for(var i=0,s=r.length;s>i;i++)n=r[i],".."===n?o.pop():"."!==n&&""!==n&&o.push(n);return o.join("/")},i=function(e){return e.split("/").slice(0,-1).join("/")},s=function(t){var r=function(r){var n=i(t),s=o(n,r);return e.require(s,t)};return r.register=e.require.register,r.shim=e.require.shim,r},a=function(e,t){var n={id:e,exports:{}};return r[e]=n,t(n.exports,s(e),n),n.exports},l=function(e,i){var s=o(e,".");if(null==i&&(i="/"),n(r,s))return r[s].exports;if(n(t,s))return a(s,t[s]);var l=o(s,"./index");if(n(r,l))return r[l].exports;if(n(t,l))return a(l,t[l]);throw new Error('Cannot find module "'+e+'" from "'+i+'"')},u=function(e,r){if("object"==typeof e)for(var o in e)n(e,o)&&(t[o]=e[o]);else t[e]=r},c=Object.prototype.toString,d=function(e){return"[object Array]"===c.call(e)},p=function(t){if("undefined"!=typeof window){d(t)||(t=[t]);for(var r=function(t){var r;try{if(e.require(t.path))return}catch(n){}try{for(var o=0,i=e.requires.length;i>o&&!(r=e.requires[o](t.path));o++);}catch(n){}if(!r&&t.symbol){var s=t.symbol.split(".");r=window;for(var a=0,l=s.length;l>a&&(r=r[s[a]]);a++);}if(!r){if(t.optional)return;throw new Error("Missing dependency: "+t.path)}e.require.register(t.path,function(e,t,n){return n.exports=r}),t.alias&&e.require.register(t.alias,function(e,t,n){return n.exports=r})},n=0,o=t.length;o>n;n++)r(t[n])}};e.require=l,e.require.register=u,e.require.shim=p}.call(this);var t=e.require;t.register("collection-observable",function(e,t){var r,n,o,i,s,a,l=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};i=t("./kb"),a=t("underscore"),s=t("knockout"),o=0,r=-1,n=1,i.compare=function(e,t){return a.isString(e)?e.localeCompare(""+t):a.isString(t)?t.localeCompare(""+e):e===t?o:t>e?r:n},i.CollectionObservable=function(){function e(e,t){return i.ignore(function(r){return function(){var n,o,l;return!a.isUndefined(t)||e instanceof i.Collection?a.isArray(e)&&(e=new i.Collection(e)):(l=[new i.Collection,e],e=l[0],t=l[1]),t||(t={}),o=i.utils.wrappedObservable(r,s.observableArray([])),o.__kb_is_co=!0,r.in_edit=0,r.__kb||(r.__kb={}),r.__kb._onCollectionChange=a.bind(r._onCollectionChange,r),t=i.utils.collapseOptions(t),t.auto_compact&&(r.auto_compact=!0),r._comparator=s.observable(t.sort_attribute?r._attributeComparator(t.sort_attribute):t.comparator),r._filters=s.observableArray(t.filters?a.isArray(t.filters)?t.filters:t.filters?[t.filters]:void 0:[]),n=r.create_options={store:i.Store.useOptionsOrCreate(t,e,o)},r.path=t.path,n.factory=i.utils.wrappedFactory(o,r._shareOrCreateFactory(t)),n.path=i.utils.pathJoin(t.path,"models"),n.creator=n.factory.creatorForPath(null,n.path),n.creator&&(r.models_only=n.creator.models_only),i.publishMethods(o,r,["destroy","shareOptions","filters","comparator","sortAttribute","viewModelByModel","hasViewModels"]),r._collection=s.observable(e),o.collection=r.collection=s.dependentObservable({read:function(){return r._collection()},write:function(e){return i.ignore(function(){var t;if((t=r._collection())!==e)return t&&t.unbind("all",r.__kb._onCollectionChange),e&&e.bind("all",r.__kb._onCollectionChange),r._collection(e)})}}),e&&e.bind("all",r.__kb._onCollectionChange),r._mapper=s.dependentObservable(function(){var e,t,n,l,u,c,d,p;if(e=r._comparator(),l=r._filters())for(d=0,p=l.length;p>d;d++)n=l[d],s.utils.unwrapObservable(n);return t=r._collection(),r.in_edit?void 0:(o=i.utils.wrappedObservable(r),t&&(u=t.models),u&&0!==t.models.length?(u=a.filter(u,function(e){return!l.length||r._selectModel(e)}),c=e?a.map(u,function(e){return r._createViewModel(e)}).sort(e):r.models_only?l.length?u:u.slice():a.map(u,function(e){return r._createViewModel(e)})):c=[],r.in_edit++,o(c),r.in_edit--)}),o.subscribe(a.bind(r._onObservableArrayChange,r)),!i.statistics||i.statistics.register("CollectionObservable",r),o}}(this))}return e.extend=i.extend,e.prototype.destroy=function(){var e,t,r;return r=i.utils.wrappedObservable(this),t=this._collection(),t&&(t.unbind("all",this.__kb._onCollectionChange),e=r(),e.splice(0,e.length)),this.collection.dispose(),this._collection=r.collection=this.collection=null,this._mapper.dispose(),this._mapper=null,i.release(this._filters),this._filters=null,this._comparator(null),this._comparator=null,this.create_options=null,r.collection=null,i.utils.wrappedDestroy(this),!i.statistics||i.statistics.unregister("CollectionObservable",this)},e.prototype.shareOptions=function(){var e;return e=i.utils.wrappedObservable(this),{store:i.utils.wrappedStore(e),factory:i.utils.wrappedFactory(e)}},e.prototype.filters=function(e){return this._filters(e?a.isArray(e)?e:[e]:[])},e.prototype.comparator=function(e){return this._comparator(e)},e.prototype.sortAttribute=function(e){return this._comparator(e?this._attributeComparator(e):null)},e.prototype.viewModelByModel=function(e){var t;return this.models_only?null:(t=e.hasOwnProperty(e.idAttribute)?e.idAttribute:"cid",a.find(i.peek(i.utils.wrappedObservable(this)),function(r){var n;return(null!=r&&null!=(n=r.__kb)?n.object:void 0)?r.__kb.object[t]===e[t]:!1}))},e.prototype.hasViewModels=function(){return!this.models_only},e.prototype.compact=function(){return i.ignore(function(e){return function(){var t;return t=i.utils.wrappedObservable(e),i.utils.wrappedStoreIsOwned(t)?(i.utils.wrappedStore(t).clear(),e._collection.notifySubscribers(e._collection())):void 0}}(this))},e.prototype._shareOrCreateFactory=function(e){var t,r,n,o;if(t=i.utils.pathJoin(e.path,"models"),n=e.factories,(o=e.factory)&&(r=o.creatorForPath(null,t))&&(!n||n.models===r)){if(!n)return o;if(o.hasPathMappings(n,e.path))return o}return o=new i.Factory(e.factory),n&&o.addPathMappings(n,e.path),o.creatorForPath(null,t)||(e.hasOwnProperty("models_only")?e.models_only?o.addPathMapping(t,{models_only:!0}):o.addPathMapping(t,i.ViewModel):e.view_model?o.addPathMapping(t,e.view_model):e.create?o.addPathMapping(t,{create:e.create}):o.addPathMapping(t,i.ViewModel)),o},e.prototype._onCollectionChange=function(e,t){return i.ignore(function(r){return function(){var n,o,s,a;if(!r.in_edit)switch(e){case"reset":r.auto_compact?r.compact():r._collection.notifySubscribers(r._collection());break;case"sort":case"resort":r._collection.notifySubscribers(r._collection());break;case"new":case"add":if(!r._selectModel(t))return;if(s=i.utils.wrappedObservable(r),n=r._collection(),-1===n.indexOf(t))return;if(a=r.viewModelByModel(t))return;r.in_edit++,a=r._createViewModel(t),(o=r._comparator())?(s().push(a),s.sort(o)):s.splice(n.indexOf(t),0,a),r.in_edit--;break;case"remove":case"destroy":r._onModelRemove(t);break;case"change":r._selectModel(t)?(a=r.models_only?t:r.viewModelByModel(t),a?(o=r._comparator())&&(s=i.utils.wrappedObservable(r),r.in_edit++,s.sort(o),r.in_edit--):r._onCollectionChange("add",t)):r._onModelRemove(t)}}}(this))},e.prototype._onModelRemove=function(e){var t,r;return(r=this.models_only?e:this.viewModelByModel(e))?(t=i.utils.wrappedObservable(this),this.in_edit++,t.remove(r),this.in_edit--):void 0},e.prototype._onObservableArrayChange=function(e){return i.ignore(function(t){return function(){var r,n,o,s,l,u,c,d,p;if(!t.in_edit&&(t.models_only&&(!e.length||i.utils.hasModelSignature(e[0]))||!t.models_only&&(!e.length||a.isObject(e[0])&&!i.utils.hasModelSignature(e[0]))||i._throwUnexpected(t,"incorrect type passed"),l=i.utils.wrappedObservable(t),r=i.peek(t._collection),n=i.peek(t._filters).length,r)){if(c=e,t.models_only)s=a.filter(e,function(e){return!n||t._selectModel(e)});else for(!n||(c=[]),s=[],d=0,p=e.length;p>d;d++){if(u=e[d],o=i.utils.wrappedObject(u),n){if(!t._selectModel(o))continue;c.push(u)}t.create_options.store.findOrReplace(o,t.create_options.creator,u),s.push(o)}t.in_edit++,e.length===c.length||l(c),a.isEqual(r.models,s)||r.reset(s),t.in_edit--}}}(this))},e.prototype._attributeComparator=function(e){var t;return t=function(t,r){var n;return n=s.utils.unwrapObservable(e),i.compare(t.get(n),r.get(n))},this.models_only?t:function(e,r){return t(i.utils.wrappedModel(e),i.utils.wrappedModel(r))}},e.prototype._createViewModel=function(e){return this.models_only?e:this.create_options.store.findOrCreate(e,this.create_options)},e.prototype._selectModel=function(e){var t,r,n,o,s;for(r=i.peek(this._filters),n=0,o=r.length;o>n;n++)if(t=r[n],t=i.peek(t),a.isFunction(t)){if(!t(e))return!1}else if(a.isArray(t)){if(s=e.id,l.call(t,s)<0)return!1}else if(e.id!==t)return!1;return!0},e}(),i.collectionObservable=function(e,t){return new i.CollectionObservable(e,t)}}),t.register("event-watcher",function(e,t){var r,n,o,i=function(e,t){return function(){return e.apply(t,arguments)}},s=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};r=t("./kb"),o=t("underscore"),n=t("knockout"),r.EventWatcher=function(){function e(e,t,r){this._onModelUnloaded=i(this._onModelUnloaded,this),this._onModelLoaded=i(this._onModelLoaded,this),this.__kb||(this.__kb={}),this.__kb.callbacks={},this.__kb._onModelLoaded=o.bind(this._onModelLoaded,this),this.__kb._onModelUnloaded=o.bind(this._onModelUnloaded,this),r&&this.registerCallbacks(t,r),e?this.emitter(e):this.ee=null}return e.useOptionsOrCreate=function(e,t,n,o){return e.event_watcher?(e.event_watcher.emitter()!==t&&e.event_watcher.model_ref!==t&&r._throwUnexpected(this,"emitter not matching"),r.utils.wrappedEventWatcher(n,e.event_watcher).registerCallbacks(n,o)):(r.utils.wrappedEventWatcherIsOwned(n,!0),r.utils.wrappedEventWatcher(n,new r.EventWatcher(t)).registerCallbacks(n,o))},e.prototype.destroy=function(){return this.emitter(null),this.__kb.callbacks=null,r.utils.wrappedDestroy(this)},e.prototype.emitter=function(e){var t,n,o,i,s,a,l,u;if(0===arguments.length||this.ee===e)return this.ee;this.model_ref&&(this.model_ref.unbind("loaded",this.__kb._onModelLoaded),this.model_ref.unbind("unloaded",this.__kb._onModelUnloaded),this.model_ref.release(),this.model_ref=null),r.Backbone&&r.Backbone.ModelRef&&e instanceof r.Backbone.ModelRef?(this.model_ref=e,this.model_ref.retain(),this.model_ref.bind("loaded",this.__kb._onModelLoaded),this.model_ref.bind("unloaded",this.__kb._onModelUnloaded),e=this.model_ref.model()):delete this.model_ref,s=this.ee,this.ee=e,u=this.__kb.callbacks;for(n in u)for(t=u[n],s&&s.unbind(n,t.fn),e&&this.ee.bind(n,t.fn),i=t.list,a=0,l=i.length;l>a;a++)o=i[a],o.emitter&&o.emitter(this.ee);return e},e.prototype.registerCallbacks=function(e,t){var i,a,l,u,c,d,p,_;for(e||r._throwMissing(this,"obj"),t||r._throwMissing(this,"info"),u=t.event_selector?t.event_selector:"change",l=u.split(" "),p=0,_=l.length;_>p;p++)a=l[p],a&&(i=this.__kb.callbacks[a],i||(d=[],i={list:d,fn:function(){return function(e){var t,o,i;for(o=0,i=d.length;i>o;o++)if(t=d[o],t.update&&!t.rel_fn){if(e&&t.key&&e.hasChanged&&!e.hasChanged(n.utils.unwrapObservable(t.key)))continue;!r.statistics||r.statistics.addModelEvent({name:a,model:e,key:t.key,path:t.path}),t.update()}return null}}(this)},this.__kb.callbacks[a]=i,this.ee&&this.ee.bind(a,i.fn)),c=o.defaults({obj:e},t),i.list.push(c));this.ee&&(s.call(l,"change")>=0&&(c.unbind_fn=r.orm.bind(this.ee,c.key,c.update,c.path)),c.emitter(this.ee)&&c.emitter)},e.prototype.releaseCallbacks=function(e){var t,n,o,i,s,a;if(this.__kb.callbacks&&this.ee){s=this.__kb.callbacks;for(n in s){t=s[n],a=t.list;for(o in a)if(i=a[o],i.obj===e)return t.list.splice(o,1),i.unbind_fn&&(i.unbind_fn(),i.unbind_fn=null),void(!r.wasReleased(e)&&i.emitter&&i.emitter(null))}}},e.prototype._onModelLoaded=function(e){var t,n,o,i,s,a,l;this.ee=e,a=this.__kb.callbacks;for(n in a)for(t=a[n],e.bind(n,t.fn),l=t.list,i=0,s=l.length;s>i;i++)o=l[i],o.unbind_fn=r.orm.bind(e,o.key,o.update,o.path),o.emitter&&o.emitter(e)},e.prototype._onModelUnloaded=function(e){var t,r,n,o,i,s,a;this.ee=null,a=this.__kb.callbacks;for(r in a)for(t=a[r],e.unbind(r,t.fn),o=t.list,i=0,s=o.length;s>i;i++)n=o[i],n.unbind_fn&&(n.unbind_fn(),n.unbind_fn=null),n.emitter&&n.emitter(null)},e}(),r.emitterObservable=function(e,t){return new r.EventWatcher(e,t)}}),t.register("factory",function(e,t){var r,n;r=t("./kb"),n=t("underscore"),r.Factory=function(){function e(e){this.parent_factory=e,this.paths={}}return e.useOptionsOrCreate=function(e,t,n){var o;return e.factory&&(!e.factories||e.factories&&e.factory.hasPathMappings(e.factories,n))?r.utils.wrappedFactory(t,e.factory):(o=r.utils.wrappedFactory(t,new r.Factory(e.factory)),e.factories&&o.addPathMappings(e.factories,n),o)},e.prototype.hasPath=function(e){return this.paths.hasOwnProperty(e)||this.parent_factory&&this.parent_factory.hasPath(e)},e.prototype.addPathMapping=function(e,t){return this.paths[e]=t},e.prototype.addPathMappings=function(e,t){var n,o;for(o in e)n=e[o],this.paths[r.utils.pathJoin(t,o)]=n},e.prototype.hasPathMappings=function(e,t){var n,o,i,s;n=!0;for(s in e)o=e[s],n&=(i=this.creatorForPath(null,r.utils.pathJoin(t,s)))&&o===i;return n},e.prototype.creatorForPath=function(e,t){var r;return(r=this.paths[t])?r.view_model?r.view_model:r:this.parent_factory&&(r=this.parent_factory.creatorForPath(e,t))?r:null},e}()}),t.register("index",function(e,t,r){var n,o,i,s,a,l,u,c,d,p,_,f;for("undefined"!=typeof window&&null!==window&&t.shim&&t.shim([{symbol:"_",path:"lodash",alias:"underscore",optional:!0},{symbol:"_",path:"underscore"},{symbol:"Backbone",path:"backbone"},{symbol:"ko",path:"knockout"}]),r.exports=i=t("./kb"),p=["./utils","./event-watcher","./store","./factory","./observable","./view-model","./collection-observable","./orm","./inject"],s=0,u=p.length;u>s;s++)n=p[s],t(n);for(_=["./default-observable","./formatted-observable","./localized-observable","./statistics","./triggered-observable","./validation"],a=0,c=_.length;c>a;a++){n=_[a];try{t(n)}catch(b){o=b}}for(i.modules={},f=["underscore","backbone","knockout"],l=0,d=f.length;d>l;l++)n=f[l],i.modules[n]=t(n)}),t.register("inject",function(e,t){var r,n,o,i,s;r=t("./kb"),i=t("underscore"),n=t("knockout"),r.RECUSIVE_AUTO_INJECT=!0,n.bindingHandlers.inject={init:function(e,t,o,i){return r.Inject.inject(n.utils.unwrapObservable(t()),i,e,t,o)}},r.Inject=function(){function e(){}return e.inject=function(e,t,o,s,a,l){var u,c,d;return u=function(e){var n,u,c;if(i.isFunction(e))t=new e(t,o,s,a),r.releaseOnNodeRemove(t,o);else{e.view_model&&(t=new e.view_model(t,o,s,a),r.releaseOnNodeRemove(t,o));for(n in e)c=e[n],"view_model"!==n&&("create"===n?c(t,o,s,a):i.isObject(c)&&!i.isFunction(c)?(u=l||c&&c.create?{}:t,t[n]=r.Inject.inject(c,u,o,s,a,!0)):t[n]=c)}return t},l?u(e):(c=(d=n.dependentObservable(function(){return u(e)}))(),d.dispose(),c)},e.injectViewModels=function(e){var t,n,o,s,a,l,u,c,d,p;for(c=[],l=function(e){var t,r,n,o,s;for(e.__kb_injected||e.attributes&&(t=i.find(e.attributes,function(e){return"kb-inject"===e.name}))&&(e.__kb_injected=!0,c.push({el:e,view_model:{},binding:t.value})),s=e.childNodes,n=0,o=s.length;o>n;n++)r=s[n],l(r)},e||"undefined"==typeof document||null===document||(e=document),l(e),d=0,p=c.length;p>d;d++)n=c[d],(a=n.binding)&&(a.search(/[:]/)<0||(a="{"+a+"}"),s=new Function("","return ( "+a+" )")(),s||(s={}),!s.options||(u=s.options,delete s.options),u||(u={}),n.view_model=r.Inject.inject(s,n.view_model,n.el,null,null,!0),t=n.view_model.afterBinding||u.afterBinding,o=n.view_model.beforeBinding||u.beforeBinding),o&&o(n.view_model,n.el,u),r.applyBindings(n.view_model,n.el,u),t&&t(n.view_model,n.el,u);return c},e}(),s=n.applyBindings,n.applyBindings=function(e,t){var n;return n=r.RECUSIVE_AUTO_INJECT?r.injectViewModels(t):[],n.length?void 0:s.apply(this,arguments)},r.injectViewModels=r.Inject.injectViewModels,"undefined"!=typeof document&&null!==document&&(this.$?this.$(function(){return r.injectViewModels()}):(o=function(){return"complete"!==document.readyState?setTimeout(o,0):r.injectViewModels()})())}),t.register("kb",function(e,t,r){var n,o,i,s;s=t("underscore"),i=t("knockout"),n=function(e,t){var r,n;for(r in t)n=t[r],e[r]=n;return e};var a=function(){},l=function(e,t,r){var o;return o=t&&t.hasOwnProperty("constructor")?t.constructor:function(){e.apply(this,arguments)},n(o,e),a.prototype=e.prototype,o.prototype=new a,t&&n(o.prototype,t),r&&n(o,r),o.prototype.constructor=o,o.__super__=e.prototype,o},u=function(e,t){var r=l(this,e,t);return r.extend=this.extend,r};r.exports=o=function(){function e(){}var t;return e.VERSION="0.18.6",e.TYPE_UNKNOWN=0,e.TYPE_SIMPLE=1,e.TYPE_ARRAY=2,e.TYPE_MODEL=3,e.TYPE_COLLECTION=4,e.wasReleased=function(e){return!e||e.__kb_released},e.isReleaseable=function(t,r){var n,o;if(null==r&&(r=0),!t||t!==Object(t)||t.__kb_released)return!1;if(i.isObservable(t)||t instanceof e.ViewModel)return!0;if("function"==typeof t||t instanceof e.Model||t instanceof e.Collection)return!1;if("function"==typeof t.dispose||"function"==typeof t.destroy||"function"==typeof t.release)return!0;if(1>r)for(n in t)if(o=t[n],"__kb"!==n&&e.isReleaseable(o,r+1))return!0;return!1},e.release=function(t){var r,n,o;if(e.isReleaseable(t))if(s.isArray(t))for(n in t)o=t[n],e.isReleaseable(o)&&(t[n]=null,e.release(o));else if(t.__kb_released=!0,i.isObservable(t)&&s.isArray(r=e.peek(t))){if(t.__kb_is_co||t.__kb_is_o&&t.valueType()===e.TYPE_COLLECTION)t.destroy?t.destroy():t.dispose&&t.dispose();else if(r.length)for(n in r)o=r[n],e.isReleaseable(o)&&(r[n]=null,e.release(o))}else"function"==typeof t.release?t.release():"function"==typeof t.destroy?t.destroy():"function"==typeof t.dispose?t.dispose():i.isObservable(t)||this.releaseKeys(t)},e.releaseKeys=function(t){var r,n;for(r in t)n=t[r],"__kb"!==r&&e.isReleaseable(n)&&(t[r]=null,e.release(n))},e.releaseOnNodeRemove=function(t,r){return t||e._throwUnexpected(this,"missing view model"),r||e._throwUnexpected(this,"missing node"),i.utils.domNodeDisposal.addDisposeCallback(r,function(){return e.release(t)})},e.renderTemplate=function(t,r,n){var o,s;return null==n&&(n={}),"undefined"==typeof document||null===document?"undefined"!=typeof console&&null!==console?console.log("renderTemplate: document is undefined"):void 0:(o=document.createElement("div"),s=i.renderTemplate(t,r,n,o,"replaceChildren"),1===o.children.length&&(o=o.children[0]),e.releaseOnNodeRemove(r,o),s.dispose(),r.afterRender&&!n.afterRender&&r.afterRender(o),o)},e.applyBindings=function(t,r){return i.applyBindings(t,r),e.releaseOnNodeRemove(t,r)},e.getValue=function(t,r,n){return t?s.isFunction(t[r])&&e.orm.useFunction(t,r)?t[r]():n?t.get.apply(t,s.map([r].concat(n),function(t){return e.peek(t)})):t.get(r):void 0},e.setValue=function(t,r,n){var o;if(t)return s.isFunction(t[r])&&e.orm.useFunction(t,r)?t[r](n):((o={})[r]=n,t.set(o))},e.ignore=(null!=(t=i.dependencyDetection)?t.ignore:void 0)||function(e,t,r){var n;return n=null,i.dependentObservable(function(){return n=e.apply(t,r||[])}).dispose(),n},e.extend=u,e._throwMissing=function(e,t){throw""+(s.isString(e)?e:e.constructor.name)+": "+t+" is missing"},e._throwUnexpected=function(e,t){throw""+(s.isString(e)?e:e.constructor.name)+": "+t+" is unexpected"},e.publishMethods=function(t,r,n){var o,i,s;for(i=0,s=n.length;s>i;i++)o=n[i],t[o]=e._.bind(r[o],r)},e.peek=function(t){return i.isObservable(t)?t.peek?t.peek():e.ignore(function(){return t()}):t},e}(),this.Parse?(o.Parse=this.Parse,o.Collection=this.Parse.Collection,o.Model=this.Parse.Object,o.Events=this.Parse.Events):(o.Backbone=t("backbone"),o.Collection=o.Backbone.Collection,o.Model=o.Backbone.Model,o.Events=o.Backbone.Events),o._=t("underscore"),o.ko=t("knockout")}),t.register("observable",function(e,t){var r,n,o;r=t("./kb"),o=t("underscore"),n=t("knockout"),r.Observable=function(){function e(e,t,i){return this._vm=null!=i?i:{},r.ignore(function(i){return function(){var s,a,l;return t||r._throwMissing(i,"options"),s=i.create_options=o.isString(t)||n.isObservable(t)?{key:t}:r.utils.collapseOptions(t),i.key=s.key,delete s.key,i.key||r._throwMissing(i,"key"),!s.args||(i.args=s.args,delete s.args),!s.read||(i.read=s.read,delete s.read),!s.write||(i.write=s.write,delete s.write),a=s.event_watcher,delete s.event_watcher,i._vo=n.observable(null),i._model=n.observable(),l=r.utils.wrappedObservable(i,n.dependentObservable({read:function(){var e,t,s,a,l,u;for(l=i._model(),u=t=[i.key].concat(i.args||[]),s=0,a=u.length;a>s;s++)e=u[s],n.utils.unwrapObservable(e);return i.read?i.update(i.read.apply(i._vm,t)):o.isUndefined(l)||r.ignore(function(){return i.update(r.getValue(l,r.peek(i.key),i.args))}),n.utils.unwrapObservable(i._vo())},write:function(e){return r.ignore(function(){var t,n;return t=r.utils.unwrapModels(e),n=r.peek(i._model),i.write?(i.write.call(i._vm,t),e=r.getValue(n,r.peek(i.key),i.args)):n&&r.setValue(n,r.peek(i.key),t),i.update(e)})},owner:i._vm})),l.__kb_is_o=!0,s.store=r.utils.wrappedStore(l,s.store),s.path=r.utils.pathJoin(s.path,i.key),s.factories&&("function"==typeof s.factories||s.factories.create)?(s.factory=r.utils.wrappedFactory(l,new r.Factory(s.factory)),s.factory.addPathMapping(s.path,s.factories)):s.factory=r.Factory.useOptionsOrCreate(s,l,s.path),delete s.factories,r.publishMethods(l,i,["value","valueType","destroy"]),l.model=i.model=n.dependentObservable({read:function(){return n.utils.unwrapObservable(i._model)},write:function(e){return r.ignore(function(){var t;if(!i.__kb_released&&r.peek(i._model)!==e)return t=r.getValue(e,r.peek(i.key),i.args),i._model(e),e?o.isUndefined(t)?void 0:i.update(t):i.update(null)})}}),r.EventWatcher.useOptionsOrCreate({event_watcher:a},e,i,{emitter:i.model,update:o.bind(i.update,i),key:i.key,path:s.path}),i.__kb_value||i.update(),r.LocalizedObservable&&s.localizer&&(l=new s.localizer(l),delete s.localizer),r.DefaultObservable&&s.hasOwnProperty("default")&&(l=r.defaultObservable(l,s["default"]),delete s["default"]),l}}(this))}return e.prototype.destroy=function(){var e;return e=r.utils.wrappedObservable(this),this.__kb_released=!0,r.release(this.__kb_value),this.__kb_value=null,this.model.dispose(),this.model=e.model=null,r.utils.wrappedDestroy(this)},e.prototype.value=function(){return this.__kb_value},e.prototype.valueType=function(){var e;return e=r.getValue(r.peek(this._model),r.peek(this.key)),this.value_type||this._updateValueObservable(e),this.value_type},e.prototype.update=function(e){var t,n;if(!this.__kb_released){if(arguments.length||(e=r.getValue(r.peek(this._model),r.peek(this.key))),void 0!==e||(e=null),t=r.utils.valueType(e),(!this.__kb_value||this.__kb_value.__kb_released||this.__kb_value.__kb_null&&e)&&(this.__kb_value=void 0,this.value_type=void 0),n=this.__kb_value,o.isUndefined(this.value_type)||this.value_type!==t&&t!==r.TYPE_UNKNOWN)return this.value_type===r.TYPE_COLLECTION&&t===r.TYPE_ARRAY?n(e):this._updateValueObservable(e);if(this.value_type===r.TYPE_MODEL){if("function"==typeof n.model){if(n.model()!==e)return n.model(e)}else if(r.utils.wrappedObject(n)!==e)return this._updateValueObservable(e)}else if(this.value_type===r.TYPE_COLLECTION){if(n.collection()!==e)return n.collection(e)}else if(n()!==e)return n(e)}},e.prototype._updateValueObservable=function(e){var t,i,s,a;return t=this.create_options,t.creator=r.utils.inferCreator(e,t.factory,t.path,r.peek(this._model),this.key),this.value_type=r.TYPE_UNKNOWN,i=t.creator,s=this.__kb_value,this.__kb_value=void 0,s&&r.release(s),i?t.store?a=t.store.findOrCreate(e,t):i.models_only?(a=e,this.value_type=r.TYPE_SIMPLE):a=i.create?i.create(e,t):new i(e,t):o.isArray(e)?(this.value_type=r.TYPE_ARRAY,a=n.observableArray(e)):(this.value_type=r.TYPE_SIMPLE,a=n.observable(e)),this.value_type===r.TYPE_UNKNOWN&&(n.isObservable(a)?this.value_type=a.__kb_is_co?r.TYPE_COLLECTION:r.TYPE_SIMPLE:(this.value_type=r.TYPE_MODEL,"function"!=typeof a.model&&r.utils.wrappedObject(a,e))),this.__kb_value=a,this._vo(a)},e}(),r.observable=function(e,t,n){return new r.Observable(e,t,n)}}),t.register("orm",function(e,t){var r,n,o,i,s,a;s=t("./kb"),a=t("underscore"),r=function(){function e(){this.adapters=[]}return e.prototype.initialize=function(){return this.adapters=a.select(this.adapters,function(e){return e.isAvailable()}),this.initialized=!0},e.prototype.addAdapter=function(e){return this.adapters.push(e),this.initialized=!1},e.prototype.keys=function(){return this._call("keys",arguments)},e.prototype.bind=function(){return this._call("bind",arguments)},e.prototype.useFunction=function(){return this._call("useFunction",arguments)},e.prototype._call=function(e,t){var r,n,o,i,s;if(this.adapters.length)for(this.initialized||this.initialize(),s=this.adapters,o=0,i=s.length;i>o;o++)if(r=s[o],r[e]&&(n=r[e].apply(r,t)))return n},e}(),s.orm=new r,o=function(){function e(){}return e.prototype.isAvailable=function(){var e,r;try{(null!=(e=s.Backbone)?e.RelationalModel:void 0)||("function"==typeof t?t("backbone-relational"):void 0)}catch(n){}return!!(null!=(r=s.Backbone)?r.RelationalModel:void 0)},e.prototype.relationType=function(e,t){var r;return e instanceof s.Backbone.RelationalModel&&(r=a.find(e.getRelations(),function(e){return e.key===t}))?r.collectionType||a.isArray(r.keyContents)?s.TYPE_COLLECTION:s.TYPE_MODEL:null},e.prototype.bind=function(e,t,r,n){var o,i,a,l,u,c;if(!(l=this.relationType(e,t)))return null;if(a=function(e){return!s.statistics||s.statistics.addModelEvent({name:"update (relational)",model:e,key:t,path:n}),r()},i=Backbone.Relation.prototype.sanitizeOptions?["update","add","remove"]:["change","add","remove"],l===s.TYPE_COLLECTION)for(u=0,c=i.length;c>u;u++)o=i[u],e.bind(""+o+":"+t,a);else e.bind(""+i[0]+":"+t,a);return function(){var r,n;if(l===s.TYPE_COLLECTION)for(r=0,n=i.length;n>r;r++)o=i[r],e.unbind(""+o+":"+t,a);else e.unbind(""+i[0]+":"+t,a)}},e}(),s.orm.addAdapter(new o),n=function(){function e(){}return e.prototype.isAvailable=function(){var e,r;try{(null!=(e=s.Backbone)?e.AssociatedModel:void 0)||("function"==typeof t?t("backbone-associations"):void 0)}catch(n){}return!!(null!=(r=s.Backbone)?r.AssociatedModel:void 0)},e.prototype.keys=function(e){return e instanceof s.Backbone.AssociatedModel?a.map(e.relations,function(e){return e.key}):null},e.prototype.relationType=function(e,t){var r;return e instanceof s.Backbone.AssociatedModel&&(r=a.find(e.relations,function(e){return e.key===t}))?"Many"===r.type?s.TYPE_COLLECTION:s.TYPE_MODEL:null},e}(),s.orm.addAdapter(new n),i=function(){function e(){}return e.prototype.isAvailable=function(){try{("undefined"!=typeof window&&null!==window?window.Supermodel:void 0)||("function"==typeof t?t("supermodel"):void 0)}catch(e){}return!!("undefined"!=typeof window&&null!==window?window.Supermodel:void 0)},e.prototype.keys=function(e){return e instanceof Supermodel.Model?a.keys(e.constructor.associations()):null},e.prototype.relationType=function(e,t){var r;return e instanceof Supermodel.Model&&(r=e.constructor.associations()[t])?r.add?s.TYPE_COLLECTION:s.TYPE_MODEL:null},e.prototype.bind=function(e,t,r,n){var o,i;return(i=this.relationType(e,t))?(o=function(e,o){var i,a;return!s.statistics||s.statistics.addModelEvent({name:"update (supermodel)",model:e,key:t,path:n}),a=e.constructor.associations()[t],i=e[a.store],e[a.store]=o,r(o),e[a.store]=i},i===s.TYPE_MODEL?(e.bind("associate:"+t,o),function(){return e.unbind("associate:"+t,o)}):void 0):null},e.prototype.useFunction=function(e,t){return!!this.relationType(e,t)},e}(),s.orm.addAdapter(new i)}),t.register("store",function(e,t){var r,n,o;r=t("./kb"),o=t("underscore"),n=t("knockout"),r.Store=function(){function e(){this.observable_records=[],this.replaced_observables=[]}return e.useOptionsOrCreate=function(e,t,n){return e.store?(e.store.register(t,n,e),r.utils.wrappedStore(n,e.store)):(r.utils.wrappedStoreIsOwned(n,!0),r.utils.wrappedStore(n,new r.Store))},e.prototype.destroy=function(){return this.clear()},e.prototype.clear=function(){var e,t,n,o;for(o=this.observable_records.splice(0,this.observable_records.length),t=0,n=o.length;n>t;t++)e=o[t],r.release(e.observable);r.release(this.replaced_observables)},e.prototype.compact=function(){var e,t,r,n,i;r=[],n=this.observable_records;for(e in n)t=n[e],(null!=(i=t.observable)?i.__kb_released:void 0)&&r.push(t);r.length&&(this.observable_records=o.difference(this.observable_records,r))},e.prototype.register=function(e,t,o){var i;if(t&&!n.isObservable(t)&&!t.__kb_is_co)return r.utils.wrappedObject(t,e),e||(t.__kb_null=!0),i=o.creator?o.creator:o.path&&o.factory?o.factory.creatorForPath(e,o.path):null,i||(i=t.constructor),this.observable_records.push({obj:e,observable:t,creator:i}),t},e.prototype.findIndex=function(e,t){var n,i,s,a;if(s=[],!e||e instanceof r.Model){a=this.observable_records;for(n in a)if(i=a[n],i.observable)if(i.observable.__kb_released)s.push(i);else if((e||i.observable.__kb_null)&&(!e||!i.observable.__kb_null&&i.obj===e)&&(i.creator===t||i.creator.create&&i.creator.create===t.create))return s.length?(this.observable_records=o.difference(this.observable_records,s),o.indexOf(this.observable_records,i)):n}return s.length&&(this.observable_records=o.difference(this.observable_records,s)),-1},e.prototype.find=function(e,t){var r;return(r=this.findIndex(e,t))<0?null:this.observable_records[r].observable},e.prototype.isRegistered=function(e){var t,r,n,o;for(o=this.observable_records,r=0,n=o.length;n>r;r++)if(t=o[r],t.observable===e)return!0;return!1},e.prototype.findOrCreate=function(e,t){var o,i;return t.store=this,t.creator||(t.creator=r.utils.inferCreator(e,t.factory,t.path)),!t.creator&&e instanceof r.Model&&(t.creator=r.ViewModel),(o=t.creator)?o.models_only?e:(o&&(i=this.find(e,o)),i?i:(i=r.ignore(function(){return function(){return i=o.create?o.create(e,t):new o(e,t),i||n.observable(null)}}(this)),n.isObservable(i)||this.isRegistered(i)||this.register(e,i,t),i)):r.utils.createFromDefaultCreator(e,t)},e.prototype.findOrReplace=function(e,t,n){var o,i;return e||r._throwUnexpected(this,"obj missing"),(o=this.findIndex(e,t))<0?this.register(e,n,{creator:t}):(i=this.observable_records[o],r.utils.wrappedObject(i.observable)===e||r._throwUnexpected(this,"different object"),i.observable!==n&&(i.observable.constructor===n.constructor||r._throwUnexpected(this,"replacing different type"),this.replaced_observables.push(i.observable),i.observable=n),n)},e}()}),t.register("utils",function(e,t){var r,n,o,i,s,a,l,u;r=t("./kb"),o=t("underscore"),n=t("knockout"),u=r._wrappedKey=function(e,t,n){return 2===arguments.length?e&&e.__kb&&e.__kb.hasOwnProperty(t)?e.__kb[t]:void 0:(e||r._throwUnexpected(this,"no obj for wrapping "+t),e.__kb||(e.__kb={}),e.__kb[t]=n,n)},i=function(e,t){return Array.prototype.splice.call(e,1,0,t),e},a=function(e,t,r){return e[t]||(e[t]=[]),o.isArray(r)||(r=[r]),e[t]=e[t].length?o.union(e[t],r):r,e},l=function(e,t,r){return e[t]||(e[t]={}),o.extend(e[t],r)},s=function(e){var t,r,n,o;for(r={},n=0,o=e.length;o>n;n++)t=e[n],r[t]={key:t};return r},r.utils=function(){function e(){}return e.wrappedObservable=function(){return u.apply(this,i(arguments,"observable"))},e.wrappedObject=function(){return u.apply(this,i(arguments,"object"))},e.wrappedModel=function(e,t){return 1===arguments.length?(t=u(e,"object"),o.isUndefined(t)?e:t):u(e,"object",t)},e.wrappedStore=function(){return u.apply(this,i(arguments,"store"))},e.wrappedStoreIsOwned=function(){return u.apply(this,i(arguments,"store_is_owned"))},e.wrappedFactory=function(){return u.apply(this,i(arguments,"factory"))},e.wrappedEventWatcher=function(){return u.apply(this,i(arguments,"event_watcher"))},e.wrappedEventWatcherIsOwned=function(){return u.apply(this,i(arguments,"event_watcher_is_owned"))},e.wrappedDestroy=function(e){var t;if(e.__kb)return e.__kb.event_watcher&&e.__kb.event_watcher.releaseCallbacks(e),t=e.__kb,e.__kb=null,t.observable&&(t.observable.destroy=t.observable.release=null,this.wrappedDestroy(t.observable),t.observable=null),t.factory=null,t.event_watcher_is_owned&&t.event_watcher.destroy(),t.event_watcher=null,t.store_is_owned&&t.store.destroy(),t.store=null
},e.valueType=function(e){return e?e.__kb_is_o?e.valueType():e.__kb_is_co||e instanceof r.Collection?r.TYPE_COLLECTION:e instanceof r.ViewModel||e instanceof r.Model?r.TYPE_MODEL:o.isArray(e)?r.TYPE_ARRAY:r.TYPE_SIMPLE:r.TYPE_UNKNOWN},e.pathJoin=function(e,t){return(e?"."!==e[e.length-1]?""+e+".":e:"")+t},e.optionsPathJoin=function(e,t){return o.defaults({path:this.pathJoin(e.path,t)},e)},e.inferCreator=function(e,t,n){var o;return t&&(o=t.creatorForPath(e,n)),o?o:e?e instanceof r.Model?r.ViewModel:e instanceof r.Collection?r.CollectionObservable:null:null},e.createFromDefaultCreator=function(e,t){return e instanceof r.Model?r.viewModel(e,t):e instanceof r.Collection?r.collectionObservable(e,t):o.isArray(e)?n.observableArray(e):n.observable(e)},e.hasModelSignature=function(e){return e&&e.attributes&&!e.models&&"function"==typeof e.get&&"function"==typeof e.trigger},e.hasCollectionSignature=function(e){return e&&e.models&&"function"==typeof e.get&&"function"==typeof e.trigger},e.collapseOptions=function(e){var t,r,n,i;for(r={},e={options:e};e.options;){i=e.options;for(t in i)switch(n=i[t],t){case"internals":case"requires":case"excludes":case"statics":a(r,t,n);break;case"keys":o.isObject(n)&&!o.isArray(n)||o.isObject(r[t])&&!o.isArray(r[t])?(o.isObject(n)||(n=[n]),o.isArray(n)&&(n=s(n)),o.isArray(r[t])&&(r[t]=s(r[t])),l(r,t,n)):a(r,t,n);break;case"factories":o.isFunction(n)?r[t]=n:l(r,t,n);break;case"static_defaults":l(r,t,n);break;case"options":break;default:r[t]=n}e=e.options}return r},e.unwrapModels=function(e){var t,n,i;if(!e)return e;if(e.__kb)return"object"in e.__kb?e.__kb.object:e;if(o.isArray(e))return o.map(e,function(e){return r.utils.unwrapModels(e)});if(o.isObject(e)&&e.constructor==={}.constructor){n={};for(t in e)i=e[t],n[t]=r.utils.unwrapModels(i);return n}return e},e}()}),t.register("view-model",function(e,t){var r,n,o;r=t("./kb"),o=t("underscore"),n=t("knockout"),r.ViewModel=function(){function e(e,t,i){return r.ignore(function(s){return function(){var a,l,u,c,d,p,_,f,b,h;if(!e||e instanceof r.Model||"function"==typeof e.get&&"function"==typeof e.bind||r._throwUnexpected(s,"not a model"),t||(t={}),i||(i={}),t=o.isArray(t)?{keys:t}:r.utils.collapseOptions(t),s.__kb||(s.__kb={}),s.__kb.vm_keys={},s.__kb.model_keys={},s.__kb.view_model=o.isUndefined(i)?s:i,!t.internals||(s.__kb.internals=t.internals),!t.excludes||(s.__kb.excludes=t.excludes),!t.statics||(s.__kb.statics=t.statics),!t.static_defaults||(s.__kb.static_defaults=t.static_defaults),r.Store.useOptionsOrCreate(t,e,s),s.__kb.path=t.path,r.Factory.useOptionsOrCreate(t,s,t.path),b=r._wrappedKey(s,"_mdl",n.observable()),s.model=n.dependentObservable({read:function(){return b(),r.utils.wrappedObject(s)},write:function(e){return r.ignore(function(){var t,n,i,a;if(r.utils.wrappedObject(s)!==e){if(s.__kb_null)return void(!e||r._throwUnexpected(s,"model set on shared null"));if(r.utils.wrappedObject(s,e),t=r.utils.wrappedEventWatcher(s),!t)return void b(e);t.emitter(e),!s.__kb.keys&&e&&e.attributes&&(n=o.keys(e.attributes),e&&(a=r.orm.keys(e))&&(n=o.union(n,a)),i=o.difference(n,o.keys(s.__kb.model_keys)),i&&s.createObservables(e,i)),b(e)}})}}),u=r.utils.wrappedEventWatcher(s,new r.EventWatcher(e,s,{emitter:s.model})),c=t.requires,s.__kb.internals&&(c=o.union(c||[],s.__kb.internals)),e&&(_=r.orm.keys(e))&&(c=o.union(c||[],_)),t.keys)if(o.isObject(t.keys)&&!o.isArray(t.keys)){d={},h=t.keys;for(f in h)p=h[f],d[o.isString(p)?p:p.key?p.key:f]=!0;s.__kb.keys=o.keys(d)}else s.__kb.keys=t.keys,c=c?o.union(c,s.__kb.keys):o.clone(s.__kb.keys);else l=u.emitter(),l&&l.attributes&&(a=o.keys(l.attributes),c=c?o.union(c,a):a);return c&&s.__kb.excludes&&(c=o.difference(c,s.__kb.excludes)),c&&s.__kb.statics&&(c=o.difference(c,s.__kb.statics)),o.isObject(t.keys)&&!o.isArray(t.keys)&&s.mapObservables(e,t.keys),o.isObject(t.requires)&&!o.isArray(t.requires)&&s.mapObservables(e,t.requires),!t.mappings||s.mapObservables(e,t.mappings),!c||s.createObservables(e,c),!s.__kb.statics||s.createObservables(e,s.__kb.statics,!0),!r.statistics||r.statistics.register("ViewModel",s),s}}(this))}return e.extend=r.extend,e.prototype.destroy=function(){var e;if(this.__kb.view_model!==this)for(e in this.__kb.vm_keys)this.__kb.view_model[e]=null;return this.__kb.view_model=null,r.releaseKeys(this),r.utils.wrappedDestroy(this),!r.statistics||r.statistics.unregister("ViewModel",this)},e.prototype.shareOptions=function(){return{store:r.utils.wrappedStore(this),factory:r.utils.wrappedFactory(this)}},e.prototype.createObservables=function(e,t,n){var i,s,a,l,u,c;for(n?a=this.__kb.static_defaults||{}:i={store:r.utils.wrappedStore(this),factory:r.utils.wrappedFactory(this),path:this.__kb.path,event_watcher:r.utils.wrappedEventWatcher(this)},u=0,c=t.length;c>u;u++)s=t[u],l=this.__kb.internals&&o.contains(this.__kb.internals,s)?"_"+s:s,this[l]||(this.__kb.vm_keys[l]=this.__kb.model_keys[s]=!0,n?e.has(l)?this[l]=this.__kb.view_model[l]=e.get(l):l in a&&(this[l]=this.__kb.view_model[l]=a[l]):(i.key=s,this[l]=this.__kb.view_model[l]=r.observable(e,i,this)))},e.prototype.mapObservables=function(e,t){var n,i,s;n={store:r.utils.wrappedStore(this),factory:r.utils.wrappedFactory(this),path:this.__kb.path,event_watcher:r.utils.wrappedEventWatcher(this)};for(s in t)i=t[s],this[s]||(i=o.isString(i)?{key:i}:o.clone(i),i.key||(i.key=s),this.__kb.vm_keys[s]=this.__kb.model_keys[i.key]=!0,this[s]=this.__kb.view_model[s]=r.observable(e,o.defaults(i,n),this))},e}(),r.viewModel=function(e,t,n){return new r.ViewModel(e,t,n)}}),"function"==typeof define&&define.amd?define(["require","underscore","backbone","knockout"],function(){return t("index")}):"object"==typeof exports?module.exports=t("index"):this.kb=t("index")}).call(this);