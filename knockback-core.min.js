/*
  knockback-core.js 0.18.6
  Copyright (c)  2011-2014 Kevin Malakoff.
  License: MIT (http://www.opensource.org/licenses/mit-license.php)
  Source: https://github.com/kmalakoff/knockback
  Dependencies: Knockout.js, Backbone.js, and Underscore.js (or LoDash.js).
  Optional dependencies: Backbone.ModelRef.js and BackboneORM.
*/
<<<<<<< HEAD
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("Backbone"),require("_"),require("ko")):"function"==typeof define&&define.amd?define(["Backbone","_","ko"],t):"object"==typeof exports?exports.knockback=t(require("Backbone"),require("_"),require("ko")):e.knockback=t(e.Backbone,e._,e.ko)}(this,function(e,t,n){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var i,o,r,s,a,l,u;this.Parse&&(this.Backbone=this.Parse,this._=this.Parse._),"undefined"!=typeof window&&null!==window&&n(4).shim&&n(4).shim([{symbol:"_",path:"lodash",alias:"underscore",optional:!0},{symbol:"_",path:"underscore"},{symbol:"Backbone",path:"backbone"},{symbol:"ko",path:"knockout"}]),e.exports=s=n(5),i=this.Parse?s.Parse=this.Parse:s.Backbone=n(1),s.Collection=i.Collection,s.Model=i.Object||i.Model,s.Events=i.Events,s._=n(2),s.ko=n(3),n(6),n(7),n(8),n(9),n(10),n(11),n(6),n(12),n(13),n(14);try{n(15)}catch(c){r=c}try{n(16)}catch(c){r=c}try{n(17)}catch(c){r=c}try{n(18)}catch(c){r=c}try{n(19)}catch(c){r=c}try{n(20)}catch(c){r=c}for(s.modules={},u=["underscore","backbone","knockout"],a=0,l=u.length;l>a;a++)o=u[a],s.modules[o]=n(4)(o)},function(t){t.exports=e},function(e){e.exports=t},function(e){e.exports=n},function(e,t,n){function i(e){return n(o(e))}function o(e){return r[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var r={"./collection-observable":12,"./collection-observable.coffee":12,"./event-watcher":7,"./event-watcher.coffee":7,"./factory":9,"./factory.coffee":9,"./inject":14,"./inject.coffee":14,"./kb":5,"./kb.coffee":5,"./observable":10,"./observable.coffee":10,"./orm":13,"./orm.coffee":13,"./store":8,"./store.coffee":8,"./utils":6,"./utils.coffee":6,"./view-model":11,"./view-model.coffee":11};i.keys=function(){return Object.keys(r)},i.resolve=o,e.exports=i},function(e,t,n){var i,o,r,s;s=n(2),r=n(3),i=function(e,t){var n,i;for(n in t)i=t[n],e[n]=i;return e};var a=function(){},l=function(e,t,n){var o;return o=t&&t.hasOwnProperty("constructor")?t.constructor:function(){e.apply(this,arguments)},i(o,e),a.prototype=e.prototype,o.prototype=new a,t&&i(o.prototype,t),n&&i(o,n),o.prototype.constructor=o,o.__super__=e.prototype,o},u=function(e,t){var n=l(this,e,t);return n.extend=this.extend,n};e.exports=o=function(){function e(){}var t;return e.VERSION="0.18.6",e.TYPE_UNKNOWN=0,e.TYPE_SIMPLE=1,e.TYPE_ARRAY=2,e.TYPE_MODEL=3,e.TYPE_COLLECTION=4,e.wasReleased=function(e){return!e||e.__kb_released},e.isReleaseable=function(t,n){var i,o;if(null==n&&(n=0),!t||t!==Object(t)||t.__kb_released)return!1;if(r.isObservable(t)||t instanceof e.ViewModel)return!0;if("function"==typeof t||t instanceof e.Model||t instanceof e.Collection)return!1;if("function"==typeof t.dispose||"function"==typeof t.destroy||"function"==typeof t.release)return!0;if(1>n)for(i in t)if(o=t[i],"__kb"!==i&&e.isReleaseable(o,n+1))return!0;return!1},e.release=function(t){var n,i,o;if(e.isReleaseable(t))if(s.isArray(t))for(i in t)o=t[i],e.isReleaseable(o)&&(t[i]=null,e.release(o));else if(t.__kb_released=!0,r.isObservable(t)&&s.isArray(n=e.peek(t))){if(t.__kb_is_co||t.__kb_is_o&&t.valueType()===e.TYPE_COLLECTION)t.destroy?t.destroy():t.dispose&&t.dispose();else if(n.length)for(i in n)o=n[i],e.isReleaseable(o)&&(n[i]=null,e.release(o))}else"function"==typeof t.release?t.release():"function"==typeof t.destroy?t.destroy():"function"==typeof t.dispose?t.dispose():r.isObservable(t)||this.releaseKeys(t)},e.releaseKeys=function(t){var n,i;for(n in t)i=t[n],"__kb"!==n&&e.isReleaseable(i)&&(t[n]=null,e.release(i))},e.releaseOnNodeRemove=function(t,n){return t||e._throwUnexpected(this,"missing view model"),n||e._throwUnexpected(this,"missing node"),r.utils.domNodeDisposal.addDisposeCallback(n,function(){return e.release(t)})},e.renderTemplate=function(t,n,i){var o,s;return null==i&&(i={}),"undefined"==typeof document||null===document?"undefined"!=typeof console&&null!==console?console.log("renderTemplate: document is undefined"):void 0:(o=document.createElement("div"),s=r.renderTemplate(t,n,i,o,"replaceChildren"),1===o.children.length&&(o=o.children[0]),e.releaseOnNodeRemove(n,o),s.dispose(),n.afterRender&&!i.afterRender&&n.afterRender(o),o)},e.applyBindings=function(t,n){return r.applyBindings(t,n),e.releaseOnNodeRemove(t,n)},e.getValue=function(t,n,i){return t?s.isFunction(t[n])&&e.orm.useFunction(t,n)?t[n]():i?t.get.apply(t,s.map([n].concat(i),function(t){return e.peek(t)})):t.get(n):void 0},e.setValue=function(t,n,i){var o;if(t)return s.isFunction(t[n])&&e.orm.useFunction(t,n)?t[n](i):((o={})[n]=i,t.set(o))},e.ignore=(null!=(t=r.dependencyDetection)?t.ignore:void 0)||function(e,t,n){var i;return i=null,r.dependentObservable(function(){return i=e.apply(t,n||[])}).dispose(),i},e.extend=u,e._throwMissing=function(e,t){throw""+(s.isString(e)?e:e.constructor.name)+": "+t+" is missing"},e._throwUnexpected=function(e,t){throw""+(s.isString(e)?e:e.constructor.name)+": "+t+" is unexpected"},e.publishMethods=function(t,n,i){var o,r,s;for(r=0,s=i.length;s>r;r++)o=i[r],t[o]=e._.bind(n[o],n)},e.peek=function(t){return r.isObservable(t)?t.peek?t.peek():e.ignore(function(){return t()}):t},e}()},function(e,t,n){var i,o,r,s,a,l,u,c;i=n(5),r=n(2),o=n(3),c=i._wrappedKey=function(e,t,n){return 2===arguments.length?e&&e.__kb&&e.__kb.hasOwnProperty(t)?e.__kb[t]:void 0:(e||i._throwUnexpected(this,"no obj for wrapping "+t),e.__kb||(e.__kb={}),e.__kb[t]=n,n)},s=function(e,t){return Array.prototype.splice.call(e,1,0,t),e},l=function(e,t,n){return e[t]||(e[t]=[]),r.isArray(n)||(n=[n]),e[t]=e[t].length?r.union(e[t],n):n,e},u=function(e,t,n){return e[t]||(e[t]={}),r.extend(e[t],n)},a=function(e){var t,n,i,o;for(n={},i=0,o=e.length;o>i;i++)t=e[i],n[t]={key:t};return n},i.utils=function(){function e(){}return e.wrappedObservable=function(){return c.apply(this,s(arguments,"observable"))},e.wrappedObject=function(){return c.apply(this,s(arguments,"object"))},e.wrappedModel=function(e,t){return 1===arguments.length?(t=c(e,"object"),r.isUndefined(t)?e:t):c(e,"object",t)},e.wrappedStore=function(){return c.apply(this,s(arguments,"store"))},e.wrappedStoreIsOwned=function(){return c.apply(this,s(arguments,"store_is_owned"))},e.wrappedFactory=function(){return c.apply(this,s(arguments,"factory"))},e.wrappedEventWatcher=function(){return c.apply(this,s(arguments,"event_watcher"))},e.wrappedEventWatcherIsOwned=function(){return c.apply(this,s(arguments,"event_watcher_is_owned"))},e.wrappedDestroy=function(e){var t;if(e.__kb)return e.__kb.event_watcher&&e.__kb.event_watcher.releaseCallbacks(e),t=e.__kb,e.__kb=null,t.observable&&(t.observable.destroy=t.observable.release=null,this.wrappedDestroy(t.observable),t.observable=null),t.factory=null,t.event_watcher_is_owned&&t.event_watcher.destroy(),t.event_watcher=null,t.store_is_owned&&t.store.destroy(),t.store=null},e.valueType=function(e){return e?e.__kb_is_o?e.valueType():e.__kb_is_co||e instanceof i.Collection?i.TYPE_COLLECTION:e instanceof i.ViewModel||e instanceof i.Model?i.TYPE_MODEL:r.isArray(e)?i.TYPE_ARRAY:i.TYPE_SIMPLE:i.TYPE_UNKNOWN},e.pathJoin=function(e,t){return(e?"."!==e[e.length-1]?""+e+".":e:"")+t},e.optionsPathJoin=function(e,t){return r.defaults({path:this.pathJoin(e.path,t)},e)},e.inferCreator=function(e,t,n){var o;return t&&(o=t.creatorForPath(e,n)),o?o:e?e instanceof i.Model?i.ViewModel:e instanceof i.Collection?i.CollectionObservable:null:null},e.createFromDefaultCreator=function(e,t){return e instanceof i.Model?i.viewModel(e,t):e instanceof i.Collection?i.collectionObservable(e,t):r.isArray(e)?o.observableArray(e):o.observable(e)},e.hasModelSignature=function(e){return e&&e.attributes&&!e.models&&"function"==typeof e.get&&"function"==typeof e.trigger},e.hasCollectionSignature=function(e){return e&&e.models&&"function"==typeof e.get&&"function"==typeof e.trigger},e.collapseOptions=function(e){var t,n,i,o;for(n={},e={options:e};e.options;){o=e.options;for(t in o)switch(i=o[t],t){case"internals":case"requires":case"excludes":case"statics":l(n,t,i);break;case"keys":r.isObject(i)&&!r.isArray(i)||r.isObject(n[t])&&!r.isArray(n[t])?(r.isObject(i)||(i=[i]),r.isArray(i)&&(i=a(i)),r.isArray(n[t])&&(n[t]=a(n[t])),u(n,t,i)):l(n,t,i);break;case"factories":r.isFunction(i)?n[t]=i:u(n,t,i);break;case"static_defaults":u(n,t,i);break;case"options":break;default:n[t]=i}e=e.options}return n},e.unwrapModels=function(e){var t,n,o;if(!e)return e;if(e.__kb)return"object"in e.__kb?e.__kb.object:e;if(r.isArray(e))return r.map(e,function(e){return i.utils.unwrapModels(e)});if(r.isObject(e)&&e.constructor==={}.constructor){n={};for(t in e)o=e[t],n[t]=i.utils.unwrapModels(o);return n}return e},e}()},function(e,t,n){var i,o,r,s=function(e,t){return function(){return e.apply(t,arguments)}},a=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};i=n(5),r=n(2),o=n(3),i.EventWatcher=function(){function e(e,t,n){this._onModelUnloaded=s(this._onModelUnloaded,this),this._onModelLoaded=s(this._onModelLoaded,this),this.__kb||(this.__kb={}),this.__kb.callbacks={},this.__kb._onModelLoaded=r.bind(this._onModelLoaded,this),this.__kb._onModelUnloaded=r.bind(this._onModelUnloaded,this),n&&this.registerCallbacks(t,n),e?this.emitter(e):this.ee=null}return e.useOptionsOrCreate=function(e,t,n,o){return e.event_watcher?(e.event_watcher.emitter()!==t&&e.event_watcher.model_ref!==t&&i._throwUnexpected(this,"emitter not matching"),i.utils.wrappedEventWatcher(n,e.event_watcher).registerCallbacks(n,o)):(i.utils.wrappedEventWatcherIsOwned(n,!0),i.utils.wrappedEventWatcher(n,new i.EventWatcher(t)).registerCallbacks(n,o))},e.prototype.destroy=function(){return this.emitter(null),this.__kb.callbacks=null,i.utils.wrappedDestroy(this)},e.prototype.emitter=function(e){var t,n,o,r,s,a,l,u;if(0===arguments.length||this.ee===e)return this.ee;this.model_ref&&(this.model_ref.unbind("loaded",this.__kb._onModelLoaded),this.model_ref.unbind("unloaded",this.__kb._onModelUnloaded),this.model_ref.release(),this.model_ref=null),i.Backbone&&i.Backbone.ModelRef&&e instanceof i.Backbone.ModelRef?(this.model_ref=e,this.model_ref.retain(),this.model_ref.bind("loaded",this.__kb._onModelLoaded),this.model_ref.bind("unloaded",this.__kb._onModelUnloaded),e=this.model_ref.model()):delete this.model_ref,s=this.ee,this.ee=e,u=this.__kb.callbacks;for(n in u)for(t=u[n],s&&s.unbind(n,t.fn),e&&this.ee.bind(n,t.fn),r=t.list,a=0,l=r.length;l>a;a++)o=r[a],o.emitter&&o.emitter(this.ee);return e},e.prototype.registerCallbacks=function(e,t){var n,s,l,u,c,d,h,p;for(e||i._throwMissing(this,"obj"),t||i._throwMissing(this,"info"),u=t.event_selector?t.event_selector:"change",l=u.split(" "),h=0,p=l.length;p>h;h++)s=l[h],s&&(n=this.__kb.callbacks[s],n||(d=[],n={list:d,fn:function(){return function(e){var t,n,r;for(n=0,r=d.length;r>n;n++)if(t=d[n],t.update&&!t.rel_fn){if(e&&t.key&&e.hasChanged&&!e.hasChanged(o.utils.unwrapObservable(t.key)))continue;!i.statistics||i.statistics.addModelEvent({name:s,model:e,key:t.key,path:t.path}),t.update()}return null}}(this)},this.__kb.callbacks[s]=n,this.ee&&this.ee.bind(s,n.fn)),c=r.defaults({obj:e},t),n.list.push(c));this.ee&&(a.call(l,"change")>=0&&(c.unbind_fn=i.orm.bind(this.ee,c.key,c.update,c.path)),c.emitter(this.ee)&&c.emitter)},e.prototype.releaseCallbacks=function(e){var t,n,o,r,s,a;if(this.__kb.callbacks&&this.ee){s=this.__kb.callbacks;for(n in s){t=s[n],a=t.list;for(o in a)if(r=a[o],r.obj===e)return t.list.splice(o,1),r.unbind_fn&&(r.unbind_fn(),r.unbind_fn=null),void(!i.wasReleased(e)&&r.emitter&&r.emitter(null))}}},e.prototype._onModelLoaded=function(e){var t,n,o,r,s,a,l;this.ee=e,a=this.__kb.callbacks;for(n in a)for(t=a[n],e.bind(n,t.fn),l=t.list,r=0,s=l.length;s>r;r++)o=l[r],o.unbind_fn=i.orm.bind(e,o.key,o.update,o.path),o.emitter&&o.emitter(e)},e.prototype._onModelUnloaded=function(e){var t,n,i,o,r,s,a;this.ee=null,a=this.__kb.callbacks;for(n in a)for(t=a[n],e.unbind(n,t.fn),o=t.list,r=0,s=o.length;s>r;r++)i=o[r],i.unbind_fn&&(i.unbind_fn(),i.unbind_fn=null),i.emitter&&i.emitter(null)},e}(),i.emitterObservable=function(e,t){return new i.EventWatcher(e,t)}},function(e,t,n){var i,o,r;i=n(5),r=n(2),o=n(3),e.exports=i.Store=function(){function e(){this.observable_records=[],this.replaced_observables=[]}return e.useOptionsOrCreate=function(e,t,n){return e.store?(e.store.register(t,n,e),i.utils.wrappedStore(n,e.store)):(i.utils.wrappedStoreIsOwned(n,!0),i.utils.wrappedStore(n,new i.Store))},e.prototype.destroy=function(){return this.clear()},e.prototype.clear=function(){var e,t,n,o;for(o=this.observable_records.splice(0,this.observable_records.length),t=0,n=o.length;n>t;t++)e=o[t],i.release(e.observable);i.release(this.replaced_observables)},e.prototype.compact=function(){var e,t,n,i,o;n=[],i=this.observable_records;for(e in i)t=i[e],(null!=(o=t.observable)?o.__kb_released:void 0)&&n.push(t);n.length&&(this.observable_records=r.difference(this.observable_records,n))},e.prototype.register=function(e,t,n){var r;if(t&&!o.isObservable(t)&&!t.__kb_is_co)return i.utils.wrappedObject(t,e),e||(t.__kb_null=!0),r=n.creator?n.creator:n.path&&n.factory?n.factory.creatorForPath(e,n.path):null,r||(r=t.constructor),this.observable_records.push({obj:e,observable:t,creator:r}),t},e.prototype.findIndex=function(e,t){var n,o,s,a;if(s=[],!e||e instanceof i.Model){a=this.observable_records;for(n in a)if(o=a[n],o.observable)if(o.observable.__kb_released)s.push(o);else if((e||o.observable.__kb_null)&&(!e||!o.observable.__kb_null&&o.obj===e)&&(o.creator===t||o.creator.create&&o.creator.create===t.create))return s.length?(this.observable_records=r.difference(this.observable_records,s),r.indexOf(this.observable_records,o)):n}return s.length&&(this.observable_records=r.difference(this.observable_records,s)),-1},e.prototype.find=function(e,t){var n;return(n=this.findIndex(e,t))<0?null:this.observable_records[n].observable},e.prototype.isRegistered=function(e){var t,n,i,o;for(o=this.observable_records,n=0,i=o.length;i>n;n++)if(t=o[n],t.observable===e)return!0;return!1},e.prototype.findOrCreate=function(e,t){var n,r;return t.store=this,t.creator||(t.creator=i.utils.inferCreator(e,t.factory,t.path)),!t.creator&&e instanceof i.Model&&(t.creator=i.ViewModel),(n=t.creator)?n.models_only?e:(n&&(r=this.find(e,n)),r?r:(r=i.ignore(function(){return function(){return r=n.create?n.create(e,t):new n(e,t),r||o.observable(null)}}(this)),o.isObservable(r)||this.isRegistered(r)||this.register(e,r,t),r)):i.utils.createFromDefaultCreator(e,t)},e.prototype.findOrReplace=function(e,t,n){var o,r;return e||i._throwUnexpected(this,"obj missing"),(o=this.findIndex(e,t))<0?this.register(e,n,{creator:t}):(r=this.observable_records[o],i.utils.wrappedObject(r.observable)===e||i._throwUnexpected(this,"different object"),r.observable!==n&&(r.observable.constructor===n.constructor||i._throwUnexpected(this,"replacing different type"),this.replaced_observables.push(r.observable),r.observable=n),n)},e}()},function(e,t,n){var i,o;i=n(5),o=n(2),i.Factory=function(){function e(e){this.parent_factory=e,this.paths={}}return e.useOptionsOrCreate=function(e,t,n){var o;return e.factory&&(!e.factories||e.factories&&e.factory.hasPathMappings(e.factories,n))?i.utils.wrappedFactory(t,e.factory):(o=i.utils.wrappedFactory(t,new i.Factory(e.factory)),e.factories&&o.addPathMappings(e.factories,n),o)},e.prototype.hasPath=function(e){return this.paths.hasOwnProperty(e)||this.parent_factory&&this.parent_factory.hasPath(e)},e.prototype.addPathMapping=function(e,t){return this.paths[e]=t},e.prototype.addPathMappings=function(e,t){var n,o;for(o in e)n=e[o],this.paths[i.utils.pathJoin(t,o)]=n},e.prototype.hasPathMappings=function(e,t){var n,o,r,s;n=!0;for(s in e)o=e[s],n&=(r=this.creatorForPath(null,i.utils.pathJoin(t,s)))&&o===r;return n},e.prototype.creatorForPath=function(e,t){var n;return(n=this.paths[t])?n.view_model?n.view_model:n:this.parent_factory&&(n=this.parent_factory.creatorForPath(e,t))?n:null},e}()},function(e,t,n){var i,o,r;i=n(5),r=n(2),o=n(3),i.Observable=function(){function e(e,t,n){return this._vm=null!=n?n:{},i.ignore(function(n){return function(){var s,a,l;return t||i._throwMissing(n,"options"),s=n.create_options=r.isString(t)||o.isObservable(t)?{key:t}:i.utils.collapseOptions(t),n.key=s.key,delete s.key,n.key||i._throwMissing(n,"key"),!s.args||(n.args=s.args,delete s.args),!s.read||(n.read=s.read,delete s.read),!s.write||(n.write=s.write,delete s.write),a=s.event_watcher,delete s.event_watcher,n._vo=o.observable(null),n._model=o.observable(),l=i.utils.wrappedObservable(n,o.dependentObservable({read:function(){var e,t,s,a,l,u;for(l=n._model(),u=t=[n.key].concat(n.args||[]),s=0,a=u.length;a>s;s++)e=u[s],o.utils.unwrapObservable(e);return n.read?n.update(n.read.apply(n._vm,t)):r.isUndefined(l)||i.ignore(function(){return n.update(i.getValue(l,i.peek(n.key),n.args))}),o.utils.unwrapObservable(n._vo())},write:function(e){return i.ignore(function(){var t,o;return t=i.utils.unwrapModels(e),o=i.peek(n._model),n.write?(n.write.call(n._vm,t),e=i.getValue(o,i.peek(n.key),n.args)):o&&i.setValue(o,i.peek(n.key),t),n.update(e)})},owner:n._vm})),l.__kb_is_o=!0,s.store=i.utils.wrappedStore(l,s.store),s.path=i.utils.pathJoin(s.path,n.key),s.factories&&("function"==typeof s.factories||s.factories.create)?(s.factory=i.utils.wrappedFactory(l,new i.Factory(s.factory)),s.factory.addPathMapping(s.path,s.factories)):s.factory=i.Factory.useOptionsOrCreate(s,l,s.path),delete s.factories,i.publishMethods(l,n,["value","valueType","destroy"]),l.model=n.model=o.dependentObservable({read:function(){return o.utils.unwrapObservable(n._model)},write:function(e){return i.ignore(function(){var t;if(!n.__kb_released&&i.peek(n._model)!==e)return t=i.getValue(e,i.peek(n.key),n.args),n._model(e),e?r.isUndefined(t)?void 0:n.update(t):n.update(null)})}}),i.EventWatcher.useOptionsOrCreate({event_watcher:a},e,n,{emitter:n.model,update:r.bind(n.update,n),key:n.key,path:s.path}),n.__kb_value||n.update(),i.LocalizedObservable&&s.localizer&&(l=new s.localizer(l),delete s.localizer),i.DefaultObservable&&s.hasOwnProperty("default")&&(l=i.defaultObservable(l,s["default"]),delete s["default"]),l}}(this))}return e.prototype.destroy=function(){var e;return e=i.utils.wrappedObservable(this),this.__kb_released=!0,i.release(this.__kb_value),this.__kb_value=null,this.model.dispose(),this.model=e.model=null,i.utils.wrappedDestroy(this)},e.prototype.value=function(){return this.__kb_value},e.prototype.valueType=function(){var e;return e=i.getValue(i.peek(this._model),i.peek(this.key)),this.value_type||this._updateValueObservable(e),this.value_type},e.prototype.update=function(e){var t,n;if(!this.__kb_released){if(arguments.length||(e=i.getValue(i.peek(this._model),i.peek(this.key))),void 0!==e||(e=null),t=i.utils.valueType(e),(!this.__kb_value||this.__kb_value.__kb_released||this.__kb_value.__kb_null&&e)&&(this.__kb_value=void 0,this.value_type=void 0),n=this.__kb_value,r.isUndefined(this.value_type)||this.value_type!==t&&t!==i.TYPE_UNKNOWN)return this.value_type===i.TYPE_COLLECTION&&t===i.TYPE_ARRAY?n(e):this._updateValueObservable(e);if(this.value_type===i.TYPE_MODEL){if("function"==typeof n.model){if(n.model()!==e)return n.model(e)}else if(i.utils.wrappedObject(n)!==e)return this._updateValueObservable(e)}else if(this.value_type===i.TYPE_COLLECTION){if(n.collection()!==e)return n.collection(e)}else if(n()!==e)return n(e)}},e.prototype._updateValueObservable=function(e){var t,n,s,a;return t=this.create_options,t.creator=i.utils.inferCreator(e,t.factory,t.path,i.peek(this._model),this.key),this.value_type=i.TYPE_UNKNOWN,n=t.creator,s=this.__kb_value,this.__kb_value=void 0,s&&i.release(s),n?t.store?a=t.store.findOrCreate(e,t):n.models_only?(a=e,this.value_type=i.TYPE_SIMPLE):a=n.create?n.create(e,t):new n(e,t):r.isArray(e)?(this.value_type=i.TYPE_ARRAY,a=o.observableArray(e)):(this.value_type=i.TYPE_SIMPLE,a=o.observable(e)),this.value_type===i.TYPE_UNKNOWN&&(o.isObservable(a)?this.value_type=a.__kb_is_co?i.TYPE_COLLECTION:i.TYPE_SIMPLE:(this.value_type=i.TYPE_MODEL,"function"!=typeof a.model&&i.utils.wrappedObject(a,e))),this.__kb_value=a,this._vo(a)},e}(),i.observable=function(e,t,n){return new i.Observable(e,t,n)}},function(e,t,n){var i,o,r;i=n(5),r=n(2),o=n(3),i.ViewModel=function(){function e(e,t,n){return i.ignore(function(s){return function(){var a,l,u,c,d,h,p,f,_,b;if(!e||e instanceof i.Model||"function"==typeof e.get&&"function"==typeof e.bind||i._throwUnexpected(s,"not a model"),t||(t={}),n||(n={}),t=r.isArray(t)?{keys:t}:i.utils.collapseOptions(t),s.__kb||(s.__kb={}),s.__kb.vm_keys={},s.__kb.model_keys={},s.__kb.view_model=r.isUndefined(n)?s:n,!t.internals||(s.__kb.internals=t.internals),!t.excludes||(s.__kb.excludes=t.excludes),!t.statics||(s.__kb.statics=t.statics),!t.static_defaults||(s.__kb.static_defaults=t.static_defaults),i.Store.useOptionsOrCreate(t,e,s),s.__kb.path=t.path,i.Factory.useOptionsOrCreate(t,s,t.path),_=i._wrappedKey(s,"_mdl",o.observable()),s.model=o.dependentObservable({read:function(){return _(),i.utils.wrappedObject(s)},write:function(e){return i.ignore(function(){var t,n,o,a;if(i.utils.wrappedObject(s)!==e){if(s.__kb_null)return void(!e||i._throwUnexpected(s,"model set on shared null"));if(i.utils.wrappedObject(s,e),t=i.utils.wrappedEventWatcher(s),!t)return void _(e);t.emitter(e),!s.__kb.keys&&e&&e.attributes&&(n=r.keys(e.attributes),e&&(a=i.orm.keys(e))&&(n=r.union(n,a)),o=r.difference(n,r.keys(s.__kb.model_keys)),o&&s.createObservables(e,o)),_(e)}})}}),u=i.utils.wrappedEventWatcher(s,new i.EventWatcher(e,s,{emitter:s.model})),c=t.requires,s.__kb.internals&&(c=r.union(c||[],s.__kb.internals)),e&&(p=i.orm.keys(e))&&(c=r.union(c||[],p)),t.keys)if(r.isObject(t.keys)&&!r.isArray(t.keys)){d={},b=t.keys;for(f in b)h=b[f],d[r.isString(h)?h:h.key?h.key:f]=!0;s.__kb.keys=r.keys(d)}else s.__kb.keys=t.keys,c=c?r.union(c,s.__kb.keys):r.clone(s.__kb.keys);else l=u.emitter(),l&&l.attributes&&(a=r.keys(l.attributes),c=c?r.union(c,a):a);return c&&s.__kb.excludes&&(c=r.difference(c,s.__kb.excludes)),c&&s.__kb.statics&&(c=r.difference(c,s.__kb.statics)),r.isObject(t.keys)&&!r.isArray(t.keys)&&s.mapObservables(e,t.keys),r.isObject(t.requires)&&!r.isArray(t.requires)&&s.mapObservables(e,t.requires),!t.mappings||s.mapObservables(e,t.mappings),!c||s.createObservables(e,c),!s.__kb.statics||s.createObservables(e,s.__kb.statics,!0),!i.statistics||i.statistics.register("ViewModel",s),s}}(this))}return e.extend=i.extend,e.prototype.destroy=function(){var e;if(this.__kb.view_model!==this)for(e in this.__kb.vm_keys)this.__kb.view_model[e]=null;return this.__kb.view_model=null,i.releaseKeys(this),i.utils.wrappedDestroy(this),!i.statistics||i.statistics.unregister("ViewModel",this)},e.prototype.shareOptions=function(){return{store:i.utils.wrappedStore(this),factory:i.utils.wrappedFactory(this)}},e.prototype.createObservables=function(e,t,n){var o,s,a,l,u,c;for(n?a=this.__kb.static_defaults||{}:o={store:i.utils.wrappedStore(this),factory:i.utils.wrappedFactory(this),path:this.__kb.path,event_watcher:i.utils.wrappedEventWatcher(this)},u=0,c=t.length;c>u;u++)s=t[u],l=this.__kb.internals&&r.contains(this.__kb.internals,s)?"_"+s:s,this[l]||(this.__kb.vm_keys[l]=this.__kb.model_keys[s]=!0,n?e.has(l)?this[l]=this.__kb.view_model[l]=e.get(l):l in a&&(this[l]=this.__kb.view_model[l]=a[l]):(o.key=s,this[l]=this.__kb.view_model[l]=i.observable(e,o,this)))},e.prototype.mapObservables=function(e,t){var n,o,s;n={store:i.utils.wrappedStore(this),factory:i.utils.wrappedFactory(this),path:this.__kb.path,event_watcher:i.utils.wrappedEventWatcher(this)};for(s in t)o=t[s],this[s]||(o=r.isString(o)?{key:o}:r.clone(o),o.key||(o.key=s),this.__kb.vm_keys[s]=this.__kb.model_keys[o.key]=!0,this[s]=this.__kb.view_model[s]=i.observable(e,r.defaults(o,n),this))},e}(),i.viewModel=function(e,t,n){return new i.ViewModel(e,t,n)}},function(e,t,n){var i,o,r,s,a,l,u=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};s=n(5),l=n(2),a=n(3),r=0,i=-1,o=1,s.compare=function(e,t){return l.isString(e)?e.localeCompare(""+t):l.isString(t)?t.localeCompare(""+e):e===t?r:t>e?i:o},s.CollectionObservable=function(){function e(e,t){return s.ignore(function(n){return function(){var i,o,r;return!l.isUndefined(t)||e instanceof s.Collection?l.isArray(e)&&(e=new s.Collection(e)):(r=[new s.Collection,e],e=r[0],t=r[1]),t||(t={}),o=s.utils.wrappedObservable(n,a.observableArray([])),o.__kb_is_co=!0,n.in_edit=0,n.__kb||(n.__kb={}),n.__kb._onCollectionChange=l.bind(n._onCollectionChange,n),t=s.utils.collapseOptions(t),t.auto_compact&&(n.auto_compact=!0),n._comparator=a.observable(t.sort_attribute?n._attributeComparator(t.sort_attribute):t.comparator),n._filters=a.observableArray(t.filters?l.isArray(t.filters)?t.filters:t.filters?[t.filters]:void 0:[]),i=n.create_options={store:s.Store.useOptionsOrCreate(t,e,o)},n.path=t.path,i.factory=s.utils.wrappedFactory(o,n._shareOrCreateFactory(t)),i.path=s.utils.pathJoin(t.path,"models"),i.creator=i.factory.creatorForPath(null,i.path),i.creator&&(n.models_only=i.creator.models_only),s.publishMethods(o,n,["destroy","shareOptions","filters","comparator","sortAttribute","viewModelByModel","hasViewModels"]),n._collection=a.observable(e),o.collection=n.collection=a.dependentObservable({read:function(){return n._collection()},write:function(e){return s.ignore(function(){var t;if((t=n._collection())!==e)return t&&t.unbind("all",n.__kb._onCollectionChange),e&&e.bind("all",n.__kb._onCollectionChange),n._collection(e)})}}),e&&e.bind("all",n.__kb._onCollectionChange),n._mapper=a.dependentObservable(function(){var e,t,i,r,u,c,d,h;if(e=n._comparator(),r=n._filters())for(d=0,h=r.length;h>d;d++)i=r[d],a.utils.unwrapObservable(i);return t=n._collection(),n.in_edit?void 0:(o=s.utils.wrappedObservable(n),t&&(u=t.models),u&&0!==t.models.length?(u=l.filter(u,function(e){return!r.length||n._selectModel(e)}),c=e?l.map(u,function(e){return n._createViewModel(e)}).sort(e):n.models_only?r.length?u:u.slice():l.map(u,function(e){return n._createViewModel(e)})):c=[],n.in_edit++,o(c),n.in_edit--)}),o.subscribe(l.bind(n._onObservableArrayChange,n)),!s.statistics||s.statistics.register("CollectionObservable",n),o}}(this))}return e.extend=s.extend,e.prototype.destroy=function(){var e,t,n;return n=s.utils.wrappedObservable(this),t=this._collection(),t&&(t.unbind("all",this.__kb._onCollectionChange),e=n(),e.splice(0,e.length)),this.collection.dispose(),this._collection=n.collection=this.collection=null,this._mapper.dispose(),this._mapper=null,s.release(this._filters),this._filters=null,this._comparator(null),this._comparator=null,this.create_options=null,n.collection=null,s.utils.wrappedDestroy(this),!s.statistics||s.statistics.unregister("CollectionObservable",this)},e.prototype.shareOptions=function(){var e;return e=s.utils.wrappedObservable(this),{store:s.utils.wrappedStore(e),factory:s.utils.wrappedFactory(e)}},e.prototype.filters=function(e){return this._filters(e?l.isArray(e)?e:[e]:[])},e.prototype.comparator=function(e){return this._comparator(e)},e.prototype.sortAttribute=function(e){return this._comparator(e?this._attributeComparator(e):null)},e.prototype.viewModelByModel=function(e){var t;return this.models_only?null:(t=e.hasOwnProperty(e.idAttribute)?e.idAttribute:"cid",l.find(s.peek(s.utils.wrappedObservable(this)),function(n){var i;return(null!=n&&null!=(i=n.__kb)?i.object:void 0)?n.__kb.object[t]===e[t]:!1}))},e.prototype.hasViewModels=function(){return!this.models_only},e.prototype.compact=function(){return s.ignore(function(e){return function(){var t;return t=s.utils.wrappedObservable(e),s.utils.wrappedStoreIsOwned(t)?(s.utils.wrappedStore(t).clear(),e._collection.notifySubscribers(e._collection())):void 0}}(this))},e.prototype._shareOrCreateFactory=function(e){var t,n,i,o;if(t=s.utils.pathJoin(e.path,"models"),i=e.factories,(o=e.factory)&&(n=o.creatorForPath(null,t))&&(!i||i.models===n)){if(!i)return o;if(o.hasPathMappings(i,e.path))return o}return o=new s.Factory(e.factory),i&&o.addPathMappings(i,e.path),o.creatorForPath(null,t)||(e.hasOwnProperty("models_only")?e.models_only?o.addPathMapping(t,{models_only:!0}):o.addPathMapping(t,s.ViewModel):e.view_model?o.addPathMapping(t,e.view_model):e.create?o.addPathMapping(t,{create:e.create}):o.addPathMapping(t,s.ViewModel)),o},e.prototype._onCollectionChange=function(e,t){return s.ignore(function(n){return function(){var i,o,r,a;if(!n.in_edit)switch(e){case"reset":n.auto_compact?n.compact():n._collection.notifySubscribers(n._collection());break;case"sort":case"resort":n._collection.notifySubscribers(n._collection());break;case"new":case"add":if(!n._selectModel(t))return;if(r=s.utils.wrappedObservable(n),i=n._collection(),-1===i.indexOf(t))return;if(a=n.viewModelByModel(t))return;n.in_edit++,a=n._createViewModel(t),(o=n._comparator())?(r().push(a),r.sort(o)):r.splice(i.indexOf(t),0,a),n.in_edit--;break;case"remove":case"destroy":n._onModelRemove(t);break;case"change":n._selectModel(t)?(a=n.models_only?t:n.viewModelByModel(t),a?(o=n._comparator())&&(r=s.utils.wrappedObservable(n),n.in_edit++,r.sort(o),n.in_edit--):n._onCollectionChange("add",t)):n._onModelRemove(t)}}}(this))},e.prototype._onModelRemove=function(e){var t,n;return(n=this.models_only?e:this.viewModelByModel(e))?(t=s.utils.wrappedObservable(this),this.in_edit++,t.remove(n),this.in_edit--):void 0},e.prototype._onObservableArrayChange=function(e){return s.ignore(function(t){return function(){var n,i,o,r,a,u,c,d,h;if(!t.in_edit&&(t.models_only&&(!e.length||s.utils.hasModelSignature(e[0]))||!t.models_only&&(!e.length||l.isObject(e[0])&&!s.utils.hasModelSignature(e[0]))||s._throwUnexpected(t,"incorrect type passed"),a=s.utils.wrappedObservable(t),n=s.peek(t._collection),i=s.peek(t._filters).length,n)){if(c=e,t.models_only)r=l.filter(e,function(e){return!i||t._selectModel(e)});else for(!i||(c=[]),r=[],d=0,h=e.length;h>d;d++){if(u=e[d],o=s.utils.wrappedObject(u),i){if(!t._selectModel(o))continue;c.push(u)}t.create_options.store.findOrReplace(o,t.create_options.creator,u),r.push(o)}t.in_edit++,e.length===c.length||a(c),l.isEqual(n.models,r)||n.reset(r),t.in_edit--}}}(this))},e.prototype._attributeComparator=function(e){var t;return t=function(t,n){var i;return i=a.utils.unwrapObservable(e),s.compare(t.get(i),n.get(i))},this.models_only?t:function(e,n){return t(s.utils.wrappedModel(e),s.utils.wrappedModel(n))}},e.prototype._createViewModel=function(e){return this.models_only?e:this.create_options.store.findOrCreate(e,this.create_options)},e.prototype._selectModel=function(e){var t,n,i,o,r;for(n=s.peek(this._filters),i=0,o=n.length;o>i;i++)if(t=n[i],t=s.peek(t),l.isFunction(t)){if(!t(e))return!1}else if(l.isArray(t)){if(r=e.id,u.call(t,r)<0)return!1}else if(e.id!==t)return!1;return!0},e}(),s.collectionObservable=function(e,t){return new s.CollectionObservable(e,t)}},function(e,t,n){var i,o,r,s,a,l;a=n(5),l=n(2),i=function(){function e(){this.adapters=[]}return e.prototype.initialize=function(){return this.adapters=l.select(this.adapters,function(e){return e.isAvailable()}),this.initialized=!0},e.prototype.addAdapter=function(e){return this.adapters.push(e),this.initialized=!1},e.prototype.keys=function(){return this._call("keys",arguments)},e.prototype.bind=function(){return this._call("bind",arguments)},e.prototype.useFunction=function(){return this._call("useFunction",arguments)},e.prototype._call=function(e,t){var n,i,o,r,s;if(this.adapters.length)for(this.initialized||this.initialize(),s=this.adapters,o=0,r=s.length;r>o;o++)if(n=s[o],n[e]&&(i=n[e].apply(n,t)))return i},e}(),a.orm=new i,r=function(){function e(){}return e.prototype.isAvailable=function(){var e,t;try{(null!=(e=a.Backbone)?e.RelationalModel:void 0)||n(25)}catch(i){}return!!(null!=(t=a.Backbone)?t.RelationalModel:void 0)},e.prototype.relationType=function(e,t){var n;
return e instanceof a.Backbone.RelationalModel&&(n=l.find(e.getRelations(),function(e){return e.key===t}))?n.collectionType||l.isArray(n.keyContents)?a.TYPE_COLLECTION:a.TYPE_MODEL:null},e.prototype.bind=function(e,t,n,i){var o,r,s,l,u,c;if(!(l=this.relationType(e,t)))return null;if(s=function(e){return!a.statistics||a.statistics.addModelEvent({name:"update (relational)",model:e,key:t,path:i}),n()},r=Backbone.Relation.prototype.sanitizeOptions?["update","add","remove"]:["change","add","remove"],l===a.TYPE_COLLECTION)for(u=0,c=r.length;c>u;u++)o=r[u],e.bind(""+o+":"+t,s);else e.bind(""+r[0]+":"+t,s);return function(){var n,i;if(l===a.TYPE_COLLECTION)for(n=0,i=r.length;i>n;n++)o=r[n],e.unbind(""+o+":"+t,s);else e.unbind(""+r[0]+":"+t,s)}},e}(),a.orm.addAdapter(new r),o=function(){function e(){}return e.prototype.isAvailable=function(){var e,t;try{(null!=(e=a.Backbone)?e.AssociatedModel:void 0)||n(26)}catch(i){}return!!(null!=(t=a.Backbone)?t.AssociatedModel:void 0)},e.prototype.keys=function(e){return e instanceof a.Backbone.AssociatedModel?l.map(e.relations,function(e){return e.key}):null},e.prototype.relationType=function(e,t){var n;return e instanceof a.Backbone.AssociatedModel&&(n=l.find(e.relations,function(e){return e.key===t}))?"Many"===n.type?a.TYPE_COLLECTION:a.TYPE_MODEL:null},e}(),a.orm.addAdapter(new o),s=function(){function e(){}return e.prototype.isAvailable=function(){try{("undefined"!=typeof window&&null!==window?window.Supermodel:void 0)||n(24)}catch(e){}return!!("undefined"!=typeof window&&null!==window?window.Supermodel:void 0)},e.prototype.keys=function(e){return e instanceof Supermodel.Model?l.keys(e.constructor.associations()):null},e.prototype.relationType=function(e,t){var n;return e instanceof Supermodel.Model&&(n=e.constructor.associations()[t])?n.add?a.TYPE_COLLECTION:a.TYPE_MODEL:null},e.prototype.bind=function(e,t,n,i){var o,r;return(r=this.relationType(e,t))?(o=function(e,o){var r,s;return!a.statistics||a.statistics.addModelEvent({name:"update (supermodel)",model:e,key:t,path:i}),s=e.constructor.associations()[t],r=e[s.store],e[s.store]=o,n(o),e[s.store]=r},r===a.TYPE_MODEL?(e.bind("associate:"+t,o),function(){return e.unbind("associate:"+t,o)}):void 0):null},e.prototype.useFunction=function(e,t){return!!this.relationType(e,t)},e}(),a.orm.addAdapter(new s)},function(e,t,n){var i,o,r,s,a;i=n(5),s=n(2),o=n(3),i.RECUSIVE_AUTO_INJECT=!0,o.bindingHandlers.inject={init:function(e,t,n,r){return i.Inject.inject(o.utils.unwrapObservable(t()),r,e,t,n)}},i.Inject=function(){function e(){}return e.inject=function(e,t,n,r,a,l){var u,c,d;return u=function(e){var o,u,c;if(s.isFunction(e))t=new e(t,n,r,a),i.releaseOnNodeRemove(t,n);else{e.view_model&&(t=new e.view_model(t,n,r,a),i.releaseOnNodeRemove(t,n));for(o in e)c=e[o],"view_model"!==o&&("create"===o?c(t,n,r,a):s.isObject(c)&&!s.isFunction(c)?(u=l||c&&c.create?{}:t,t[o]=i.Inject.inject(c,u,n,r,a,!0)):t[o]=c)}return t},l?u(e):(c=(d=o.dependentObservable(function(){return u(e)}))(),d.dispose(),c)},e.injectViewModels=function(e){var t,n,o,r,a,l,u,c,d,h;for(c=[],l=function(e){var t,n,i,o,r;for(e.__kb_injected||e.attributes&&(t=s.find(e.attributes,function(e){return"kb-inject"===e.name}))&&(e.__kb_injected=!0,c.push({el:e,view_model:{},binding:t.value})),r=e.childNodes,i=0,o=r.length;o>i;i++)n=r[i],l(n)},e||"undefined"==typeof document||null===document||(e=document),l(e),d=0,h=c.length;h>d;d++)n=c[d],(a=n.binding)&&(a.search(/[:]/)<0||(a="{"+a+"}"),r=new Function("","return ( "+a+" )")(),r||(r={}),!r.options||(u=r.options,delete r.options),u||(u={}),n.view_model=i.Inject.inject(r,n.view_model,n.el,null,null,!0),t=n.view_model.afterBinding||u.afterBinding,o=n.view_model.beforeBinding||u.beforeBinding),o&&o(n.view_model,n.el,u),i.applyBindings(n.view_model,n.el,u),t&&t(n.view_model,n.el,u);return c},e}(),a=o.applyBindings,o.applyBindings=function(e,t){var n;return n=i.RECUSIVE_AUTO_INJECT?i.injectViewModels(t):[],n.length?void 0:a.apply(this,arguments)},i.injectViewModels=i.Inject.injectViewModels,"undefined"!=typeof document&&null!==document&&(this.$?this.$(function(){return i.injectViewModels()}):(r=function(){return"complete"!==document.readyState?setTimeout(r,0):i.injectViewModels()})())},function(e,t,n){var i,o,r,s;try{o=n(!function(){var e=new Error('Cannot find module "knockback"');throw e.code="MODULE_NOT_FOUND",e}())}catch(a){i=a,o=n(5)}s=n(2),r=n(3),n(22),e.exports=o.DefaultObservable=function(){function e(e,t){var n;return this.dv=t,n=o.utils.wrappedObservable(this,r.dependentObservable({read:function(t){return function(){var n;return(n=r.utils.unwrapObservable(e()))?n:r.utils.unwrapObservable(t.dv)}}(this),write:function(t){return e(t)}})),o.publishMethods(n,this,["destroy","setToDefault"]),n}return e.prototype.destroy=function(){return o.utils.wrappedDestroy(this)},e.prototype.setToDefault=function(){return o.utils.wrappedObservable(this)(this.dv)},e}(),o.defaultObservable=function(e,t){return new o.DefaultObservable(e,t)}},function(e,t,n){var i,o,r,s,a;try{r=n(!function(){var e=new Error('Cannot find module "knockback"');throw e.code="MODULE_NOT_FOUND",e}())}catch(l){o=l,r=n(5)}a=n(2),s=n(3),i=Array.prototype.slice,r.toFormattedString=function(e){var t,n,o,r,l,u;l=e.slice(),n=i.call(arguments,1);for(o in n)for(t=n[o],u=s.utils.unwrapObservable(t),(a.isUndefined(u)||a.isNull(u))&&(u=""),r=e.indexOf("{"+o+"}");r>=0;)l=l.replace("{"+o+"}",u),r=e.indexOf("{"+o+"}",r+1);return l},r.parseFormattedString=function(e,t){var n,i,o,r,s,l,u,c,d,h,p,f,_;for(h=t.slice(),o=0,l=0,c={};h.search("\\{"+o+"\\}")>=0;){for(u=t.indexOf("{"+o+"}");u>=0;)h=h.replace("{"+o+"}","(.*)"),c[u]=o,l++,u=t.indexOf("{"+o+"}",u+1);o++}if(n=o,d=new RegExp(h),s=d.exec(e),s&&s.shift(),!s||s.length!==l){for(p=[];n-->0;)p.push("");return p}_=a.sortBy(a.keys(c),function(e){return parseInt(e,10)}),i={};for(r in _)u=_[r],o=c[u],i.hasOwnProperty(o)||(i[o]=r);for(f=[],o=0;n>o;)f.push(s[i[o]]),o++;return f},e.exports=r.FormattedObservable=function(){function e(e,t){var n,o;return a.isArray(t)?(e=e,o=t):o=i.call(arguments,1),n=r.utils.wrappedObservable(this,s.dependentObservable({read:function(){var n,i,a;for(t=[s.utils.unwrapObservable(e)],i=0,a=o.length;a>i;i++)n=o[i],t.push(s.utils.unwrapObservable(n));return r.toFormattedString.apply(null,t)},write:function(t){var n,i,a;for(i=r.parseFormattedString(t,s.utils.unwrapObservable(e)),a=Math.min(o.length,i.length),n=0;a>n;)o[n](i[n]),n++}}))}return e.prototype.destroy=function(){return r.utils.wrappedDestroy(this)},e}(),r.formattedObservable=function(e){return new r.FormattedObservable(e,i.call(arguments,1))}},function(e,t,n){var i,o,r,s;try{o=n(!function(){var e=new Error('Cannot find module "knockback"');throw e.code="MODULE_NOT_FOUND",e}())}catch(a){i=a,o=n(5)}s=n(2),r=n(3),o.locale_manager||(o.locale_manager=void 0),e.exports=o.LocalizedObservable=function(){function e(e,t,n){var i;return this.value=e,this.vm=n,t||(t={}),this.vm||(this.vm={}),this.read||o._throwMissing(this,"read"),o.locale_manager||o._throwMissing(this,"kb.locale_manager"),this.__kb||(this.__kb={}),this.__kb._onLocaleChange=s.bind(this._onLocaleChange,this),this.__kb._onChange=t.onChange,this.value&&(e=r.utils.unwrapObservable(this.value)),this.vo=r.observable(e?this.read(e,null):null),i=o.utils.wrappedObservable(this,r.dependentObservable({read:function(e){return function(){return e.value&&r.utils.unwrapObservable(e.value),e.vo(),e.read(r.utils.unwrapObservable(e.value))}}(this),write:function(e){return function(t){return e.write||o._throwUnexpected(e,"writing to read-only"),e.write(t,r.utils.unwrapObservable(e.value)),e.vo(t),e.__kb._onChange?e.__kb._onChange(t):void 0}}(this),owner:this.vm})),o.publishMethods(i,this,["destroy","observedValue","resetToCurrent"]),o.locale_manager.bind("change",this.__kb._onLocaleChange),t.hasOwnProperty("default")&&(i=o.DefaultObservable&&r.defaultObservable(i,t["default"])),i}return e.extend=o.extend,e.prototype.destroy=function(){return o.locale_manager.unbind("change",this.__kb._onLocaleChange),this.vm=null,o.utils.wrappedDestroy(this)},e.prototype.resetToCurrent=function(){var e,t;return t=o.utils.wrappedObservable(this),e=this.value?this.read(r.utils.unwrapObservable(this.value)):null,t()!==e?t(e):void 0},e.prototype.observedValue=function(e){return 0===arguments.length?this.value:(this.value=e,void this._onLocaleChange())},e.prototype._onLocaleChange=function(){var e;return e=this.read(r.utils.unwrapObservable(this.value)),this.vo(e),this.__kb._onChange?this.__kb._onChange(e):void 0},e}(),o.localizedObservable=function(e,t,n){return new o.LocalizedObservable(e,t,n)}},function(e,t,n){var i,o,r;try{o=n(!function(){var e=new Error('Cannot find module "knockback"');throw e.code="MODULE_NOT_FOUND",e}())}catch(s){i=s,o=n(5)}r=n(2),e.exports=o.Statistics=function(){function e(){this.model_events_tracker=[],this.registered_tracker={}}return e.prototype.clear=function(){return this.model_events_tracker=[]},e.prototype.addModelEvent=function(e){return this.model_events_tracker.push(e)},e.prototype.modelEventsStatsString=function(){var e,t,n,i;n="",n+="Total Count: "+this.model_events_tracker.length,e=r.groupBy(this.model_events_tracker,function(e){return"event name: '"+e.name+"', attribute name: '"+e.key+"'"});for(t in e)i=e[t],n+="\n "+t+", count: "+i.length;return n},e.prototype.register=function(e,t){return this.registeredTracker(e).push(t)},e.prototype.unregister=function(e,t){var n,i;return i=this.registeredTracker(e),n=r.indexOf(i,t),0>n&&"undefined"!=typeof console&&null!==console&&console.log("kb.Statistics: failed to unregister type: "+e),i.splice(n,1)},e.prototype.registeredCount=function(e){var t,n,i;if(e)return this.registeredTracker(e).length;t=0,i=this.registered_tracker[e];for(e in i)n=i[e],t+=n.length;return t},e.prototype.registeredStatsString=function(e){var t,n,i,o,r;t="",r=this.registered_tracker;for(n in r)i=r[n],i.length&&(o&&(t+="\n "),t+=""+(n?n:"No Name")+": "+i.length,o=!0);return t?t:e},e.prototype.registeredTracker=function(e){var t;return this.registered_tracker.hasOwnProperty(e)?this.registered_tracker[e]:(t=[],this.registered_tracker[e]=t,t)},e}()},function(e,t,n){var i,o,r,s;try{o=n(!function(){var e=new Error('Cannot find module "knockback"');throw e.code="MODULE_NOT_FOUND",e}())}catch(a){i=a,o=n(5)}s=n(2),r=n(3),e.exports=o.TriggeredObservable=function(){function e(e,t){var n;return this.event_selector=t,e||o._throwMissing(this,"emitter"),this.event_selector||o._throwMissing(this,"event_selector"),this.vo=r.observable(),n=o.utils.wrappedObservable(this,r.dependentObservable(function(e){return function(){return e.vo()}}(this))),o.publishMethods(n,this,["destroy"]),o.utils.wrappedEventWatcher(this,new o.EventWatcher(e,this,{emitter:s.bind(this.emitter,this),update:s.bind(this.update,this),event_selector:this.event_selector})),n}return e.prototype.destroy=function(){return o.utils.wrappedDestroy(this)},e.prototype.emitter=function(e){return 0===arguments.length||this.ee===e?this.ee:(this.ee=e)?this.update():void 0},e.prototype.update=function(){return this.ee?this.vo()!==this.ee?this.vo(this.ee):this.vo.valueHasMutated():void 0},e}(),o.triggeredObservable=function(e,t){return new o.TriggeredObservable(e,t)}},function(e,t,n){var i,o,r,s,a;try{r=n(!function(){var e=new Error('Cannot find module "knockback"');throw e.code="MODULE_NOT_FOUND",e}())}catch(l){o=l,r=n(5)}a=n(2),s=n(3),n(23),i=function(e){return e=s.utils.unwrapObservable(e),"function"==typeof e?e.apply(null,Array.prototype.slice.call(arguments,1)):e},e.exports=r.Validation=function(){function e(){}return e}(),r.valueValidator=function(e,t,n){return null==n&&(n={}),n&&!("function"==typeof n)||(n={}),s.dependentObservable(function(){var o,r,l,u,c,d,h,p;h={$error_count:0},r=s.utils.unwrapObservable(e),!("disable"in n)||(l=i(n.disable)),!("enable"in n)||(l=!i(n.enable)),d=n.priorities||[],a.isArray(d)||(d=[d]),o=d.length+1;for(u in t)p=t[u],h[u]=!l&&i(p,r),h[u]&&(h.$error_count++,(c=a.indexOf(d,u)>=0)||(c=d.length),h.$active_error&&o>c?(h.$active_error=u,o=c):h.$active_error||(h.$active_error=u,o=c));return h.$enabled=!l,h.$disable=!!l,h.$valid=0===h.$error_count,h})},r.inputValidator=function(e,t,n){var i,o,s,l,u,c,d,h,p,f;if(null==n&&(n={}),n&&!("function"==typeof n)||(n={}),p=r.valid,i=$(t),(l=i.attr("name"))&&!a.isString(l)&&(l=null),!(o=i.attr("data-bind")))return null;if(u=new Function("sc","with(sc[0]) { return { "+o+" } }")([e]),!u||!u.value)return null;if(!u.validation_options||(a.defaults(u.validation_options,n),n=u.validation_options),o={},!p[d=i.attr("type")]||(o[d]=p[d]),!i.attr("required")||(o.required=p.required),u.validations){f=u.validations;for(s in f)h=f[s],o[s]=h}return c=r.valueValidator(u.value,o,n),!l&&!n.no_attach||(e["$"+l]=c),c},r.formValidator=function(e,t){var n,i,o,l,u,c,d,h,p,f,_,b,v;for(d={},f=[],n=$(t),(o=n.attr("name"))&&!a.isString(o)&&(o=null),(i=n.attr("data-bind"))&&(c=new Function("sc","with(sc[0]) { return { "+i+" } }")([e]),h=c.validation_options),h||(h={}),h.no_attach=!!o,v=n.find("input"),_=0,b=v.length;b>_;_++)l=v[_],(u=$(l).attr("name"))&&(p=r.inputValidator(e,l,h),!p||f.push(d[u]=p));return d.$error_count=s.dependentObservable(function(){var e,t,n;for(e=0,t=0,n=f.length;n>t;t++)p=f[t],e+=p().$error_count;return e}),d.$valid=s.dependentObservable(function(){return 0===d.$error_count()}),d.$enabled=s.dependentObservable(function(){var e,t,n;for(e=!0,t=0,n=f.length;n>t;t++)p=f[t],e&=p().$enabled;return e}),d.$disabled=s.dependentObservable(function(){return!d.$enabled()}),o&&(e["$"+o]=d),d}},,function(e,t,n){var i,o,r,s;try{o=n(!function(){var e=new Error('Cannot find module "knockback"');throw e.code="MODULE_NOT_FOUND",e}())}catch(a){i=a,o=n(5)}s=n(2),r=n(3),o.Observable.prototype.setToDefault=function(){var e;null!=(e=this.__kb_value)&&"function"==typeof e.setToDefault&&e.setToDefault()},o.ViewModel.prototype.setToDefault=function(){var e,t;for(e in this.__kb.vm_keys)null!=(t=this[e])&&"function"==typeof t.setToDefault&&t.setToDefault()},o.utils.setToDefault=function(e){var t,n;if(e){if(r.isObservable(e))"function"==typeof e.setToDefault&&e.setToDefault();else if(s.isObject(e))for(t in e)n=e[t],!n||!r.isObservable(n)&&"function"==typeof n||"_"===t[0]&&!t.search("__kb")||this.setToDefault(n);return e}}},function(e,t,n){var i,o,r,s,a,l,u;try{a=n(!function(){var e=new Error('Cannot find module "knockback"');throw e.code="MODULE_NOT_FOUND",e}())}catch(c){s=c,a=n(5)}u=n(2),l=n(3),r=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,i=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}$/,o=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/,a.valid={required:function(e){return!e},url:function(e){return!r.test(e)},email:function(e){return!i.test(e)},number:function(e){return!o.test(e)}},a.hasChangedFn=function(e){var t,n;return n=null,t=null,function(){var i;return n!==(i=l.utils.unwrapObservable(e))?(n=i,t=n?n.toJSON():null,!1):n&&t?!u.isEqual(n.toJSON(),t):!1}},a.minLengthFn=function(e){return function(t){return!t||t.length<e}},a.uniqueValueFn=function(e,t,n){return function(i){var o,r,s;return s=l.utils.unwrapObservable(e),r=l.utils.unwrapObservable(t),o=l.utils.unwrapObservable(n),s&&r&&o?!!u.find(o.models,function(){return function(e){return e!==s&&e.get(r)===i}}(this)):!1}},a.untilTrueFn=function(e,t,n){var i;return i=!1,n&&l.isObservable(n)&&n.subscribe(function(){return i=!1}),function(n){var o,r;return(o=l.utils.unwrapObservable(t))?(i|=!!(r=o(l.utils.unwrapObservable(n))),i?r:l.utils.unwrapObservable(e)):l.utils.unwrapObservable(e)}},a.untilFalseFn=function(e,t,n){var i;return i=!1,n&&l.isObservable(n)&&n.subscribe(function(){return i=!1}),function(n){var o,r;return(o=l.utils.unwrapObservable(t))?(i|=!(r=o(l.utils.unwrapObservable(n))),i?r:l.utils.unwrapObservable(e)):l.utils.unwrapObservable(e)}}},function(e,t,n){t.Model=n(27),t.Collection=n(28)},function(e,t,n){var i,o;!function(r,s){i=[t,n(1),n(2)],o=s.apply(null,i),!(void 0!==o&&(e.exports=o))}(this,function(e,t,n){"use strict";t.Relational={showWarnings:!0},t.Semaphore={_permitsAvailable:null,_permitsUsed:0,acquire:function(){if(this._permitsAvailable&&this._permitsUsed>=this._permitsAvailable)throw new Error("Max permits acquired");this._permitsUsed++},release:function(){if(0===this._permitsUsed)throw new Error("All permits released");this._permitsUsed--},isLocked:function(){return this._permitsUsed>0},setAvailablePermits:function(e){if(this._permitsUsed>e)throw new Error("Available permits cannot be less than used permits");this._permitsAvailable=e}},t.BlockingQueue=function(){this._queue=[]},n.extend(t.BlockingQueue.prototype,t.Semaphore,{_queue:null,add:function(e){this.isBlocked()?this._queue.push(e):e()},process:function(){var e=this._queue;for(this._queue=[];e&&e.length;)e.shift()()},block:function(){this.acquire()},unblock:function(){this.release(),this.isBlocked()||this.process()},isBlocked:function(){return this.isLocked()}}),t.Relational.eventQueue=new t.BlockingQueue,t.Store=function(){this._collections=[],this._reverseRelations=[],this._orphanRelations=[],this._subModels=[],this._modelScopes=[e]},n.extend(t.Store.prototype,t.Events,{initializeRelation:function(e,i,o){var r=n.isString(i.type)?t[i.type]||this.getObjectByName(i.type):i.type;r&&r.prototype instanceof t.Relation?new r(e,i,o):t.Relational.showWarnings&&"undefined"!=typeof console&&console.warn("Relation=%o; missing or invalid relation type!",i)},addModelScope:function(e){this._modelScopes.push(e)},removeModelScope:function(e){this._modelScopes=n.without(this._modelScopes,e)},addSubModels:function(e,t){this._subModels.push({superModelType:t,subModels:e})},setupSuperModel:function(e){n.find(this._subModels,function(t){return n.filter(t.subModels||[],function(n,i){var o=this.getObjectByName(n);return e===o?(t.superModelType._subModels[i]=e,e._superModel=t.superModelType,e._subModelTypeValue=i,e._subModelTypeAttribute=t.superModelType.prototype.subModelTypeAttribute,!0):void 0},this).length},this)},addReverseRelation:function(e){var t=n.any(this._reverseRelations,function(t){return n.all(e||[],function(e,n){return e===t[n]})});!t&&e.model&&e.type&&(this._reverseRelations.push(e),this._addRelation(e.model,e),this.retroFitRelation(e))},addOrphanRelation:function(e){var t=n.any(this._orphanRelations,function(t){return n.all(e||[],function(e,n){return e===t[n]})});!t&&e.model&&e.type&&this._orphanRelations.push(e)},processOrphanRelations:function(){n.each(this._orphanRelations.slice(0),function(e){var i=t.Relational.store.getObjectByName(e.relatedModel);i&&(this.initializeRelation(null,e),this._orphanRelations=n.without(this._orphanRelations,e))},this)},_addRelation:function(e,t){e.prototype.relations||(e.prototype.relations=[]),e.prototype.relations.push(t),n.each(e._subModels||[],function(e){this._addRelation(e,t)},this)},retroFitRelation:function(e){var t=this.getCollection(e.model,!1);t&&t.each(function(t){t instanceof e.model&&new e.type(t,e)},this)},getCollection:function(e,i){e instanceof t.RelationalModel&&(e=e.constructor);for(var o=e;o._superModel;)o=o._superModel;var r=n.find(this._collections,function(e){return e.model===o});return r||i===!1||(r=this._createCollection(o)),r},getObjectByName:function(e){var t=e.split("."),i=null;return n.find(this._modelScopes,function(e){return i=n.reduce(t||[],function(e,t){return e?e[t]:void 0},e),i&&i!==e?!0:void 0},this),i},_createCollection:function(e){var n;return e instanceof t.RelationalModel&&(e=e.constructor),e.prototype instanceof t.RelationalModel&&(n=new t.Collection,n.model=e,this._collections.push(n)),n},resolveIdForItem:function(e,i){var o=n.isString(i)||n.isNumber(i)?i:null;return null===o&&(i instanceof t.RelationalModel?o=i.id:n.isObject(i)&&(o=i[e.prototype.idAttribute])),o||0===o||(o=null),o},find:function(e,t){var n=this.resolveIdForItem(e,t),i=this.getCollection(e);if(i){var o=i.get(n);if(o instanceof e)return o}return null},register:function(e){var t=this.getCollection(e);if(t){var n=e.collection;t.add(e),e.collection=n}},checkId:function(e,n){var i=this.getCollection(e),o=i&&i.get(n);if(o&&e!==o)throw t.Relational.showWarnings&&"undefined"!=typeof console&&console.warn("Duplicate id! Old RelationalModel=%o, new RelationalModel=%o",o,e),new Error("Cannot instantiate more than one Backbone.RelationalModel with the same id per type!")},update:function(e){var t=this.getCollection(e);t.contains(e)||this.register(e),t._onModelEvent("change:"+e.idAttribute,e,t),e.trigger("relational:change:id",e,t)},unregister:function(e){var i,o;e instanceof t.Model?(i=this.getCollection(e),o=[e]):e instanceof t.Collection?(i=this.getCollection(e.model),o=n.clone(e.models)):(i=this.getCollection(e),o=n.clone(i.models)),n.each(o,function(e){this.stopListening(e),n.invoke(e.getRelations(),"stopListening")},this),n.contains(this._collections,e)?i.reset([]):n.each(o,function(e){i.get(e)?i.remove(e):i.trigger("relational:remove",e,i)},this)},reset:function(){this.stopListening(),n.each(this._collections,function(e){this.unregister(e)},this),this._collections=[],this._subModels=[],this._modelScopes=[e]}}),t.Relational.store=new t.Store,t.Relation=function(e,i,o){if(this.instance=e,i=n.isObject(i)?i:{},this.reverseRelation=n.defaults(i.reverseRelation||{},this.options.reverseRelation),this.options=n.defaults(i,this.options,t.Relation.prototype.options),this.reverseRelation.type=n.isString(this.reverseRelation.type)?t[this.reverseRelation.type]||t.Relational.store.getObjectByName(this.reverseRelation.type):this.reverseRelation.type,this.key=this.options.key,this.keySource=this.options.keySource||this.key,this.keyDestination=this.options.keyDestination||this.keySource||this.key,this.model=this.options.model||this.instance.constructor,this.relatedModel=this.options.relatedModel,!n.isFunction(this.relatedModel)||this.relatedModel.prototype instanceof t.RelationalModel||(this.relatedModel=n.result(this,"relatedModel")),n.isString(this.relatedModel)&&(this.relatedModel=t.Relational.store.getObjectByName(this.relatedModel)),this.checkPreconditions()&&(!this.options.isAutoRelation&&this.reverseRelation.type&&this.reverseRelation.key&&t.Relational.store.addReverseRelation(n.defaults({isAutoRelation:!0,model:this.relatedModel,relatedModel:this.model,reverseRelation:this.options},this.reverseRelation)),e)){var r=this.keySource;r!==this.key&&"object"==typeof this.instance.get(this.key)&&(r=this.key),this.setKeyContents(this.instance.get(r)),this.relatedCollection=t.Relational.store.getCollection(this.relatedModel),this.keySource!==this.key&&delete this.instance.attributes[this.keySource],this.instance._relations[this.key]=this,this.initialize(o),this.options.autoFetch&&this.instance.fetchRelated(this.key,n.isObject(this.options.autoFetch)?this.options.autoFetch:{}),this.listenTo(this.instance,"destroy",this.destroy).listenTo(this.relatedCollection,"relational:add relational:change:id",this.tryAddRelated).listenTo(this.relatedCollection,"relational:remove",this.removeRelated)}},t.Relation.extend=t.Model.extend,n.extend(t.Relation.prototype,t.Events,t.Semaphore,{options:{createModels:!0,includeInJSON:!0,isAutoRelation:!1,autoFetch:!1,parse:!1},instance:null,key:null,keyContents:null,relatedModel:null,relatedCollection:null,reverseRelation:null,related:null,checkPreconditions:function(){var e=this.instance,i=this.key,o=this.model,r=this.relatedModel,s=t.Relational.showWarnings&&"undefined"!=typeof console;if(!o||!i||!r)return s&&console.warn("Relation=%o: missing model, key or relatedModel (%o, %o, %o).",this,o,i,r),!1;if(!(o.prototype instanceof t.RelationalModel))return s&&console.warn("Relation=%o: model does not inherit from Backbone.RelationalModel (%o).",this,e),!1;if(!(r.prototype instanceof t.RelationalModel))return s&&console.warn("Relation=%o: relatedModel does not inherit from Backbone.RelationalModel (%o).",this,r),!1;if(this instanceof t.HasMany&&this.reverseRelation.type===t.HasMany)return s&&console.warn("Relation=%o: relation is a HasMany, and the reverseRelation is HasMany as well.",this),!1;if(e&&n.keys(e._relations).length){var a=n.find(e._relations,function(e){return e.key===i},this);if(a)return s&&console.warn("Cannot create relation=%o on %o for model=%o: already taken by relation=%o.",this,i,e,a),!1}return!0},setRelated:function(e){this.related=e,this.instance.attributes[this.key]=e},_isReverseRelation:function(e){return e.instance instanceof this.relatedModel&&this.reverseRelation.key===e.key&&this.key===e.reverseRelation.key},getReverseRelations:function(e){var t=[],i=n.isUndefined(e)?this.related&&(this.related.models||[this.related]):[e];return n.each(i||[],function(e){n.each(e.getRelations()||[],function(e){this._isReverseRelation(e)&&t.push(e)},this)},this),t},destroy:function(){this.stopListening(),this instanceof t.HasOne?this.setRelated(null):this instanceof t.HasMany&&this.setRelated(this._prepareCollection()),n.each(this.getReverseRelations(),function(e){e.removeRelated(this.instance)},this)}}),t.HasOne=t.Relation.extend({options:{reverseRelation:{type:"HasMany"}},initialize:function(e){this.listenTo(this.instance,"relational:change:"+this.key,this.onChange);var t=this.findRelated(e);this.setRelated(t),n.each(this.getReverseRelations(),function(t){t.addRelated(this.instance,e)},this)},findRelated:function(e){var t=null;if(e=n.defaults({parse:this.options.parse},e),this.keyContents instanceof this.relatedModel)t=this.keyContents;else if(this.keyContents||0===this.keyContents){var i=n.defaults({create:this.options.createModels},e);t=this.relatedModel.findOrCreate(this.keyContents,i)}return t&&(this.keyId=null),t},setKeyContents:function(e){this.keyContents=e,this.keyId=t.Relational.store.resolveIdForItem(this.relatedModel,this.keyContents)},onChange:function(e,i,o){if(!this.isLocked()){this.acquire(),o=o?n.clone(o):{};var r=n.isUndefined(o.__related),s=r?this.related:o.__related;if(r){this.setKeyContents(i);var a=this.findRelated(o);this.setRelated(a)}if(s&&this.related!==s&&n.each(this.getReverseRelations(s),function(e){e.removeRelated(this.instance,null,o)},this),n.each(this.getReverseRelations(),function(e){e.addRelated(this.instance,o)},this),!o.silent&&this.related!==s){var l=this;this.changed=!0,t.Relational.eventQueue.add(function(){l.instance.trigger("change:"+l.key,l.instance,l.related,o,!0),l.changed=!1})}this.release()}},tryAddRelated:function(e,t,n){!this.keyId&&0!==this.keyId||e.id!==this.keyId||(this.addRelated(e,n),this.keyId=null)},addRelated:function(e,t){var i=this;e.queue(function(){if(e!==i.related){var o=i.related||null;i.setRelated(e),i.onChange(i.instance,e,n.defaults({__related:o},t))}})},removeRelated:function(e,t,i){if(this.related&&e===this.related){var o=this.related||null;this.setRelated(null),this.onChange(this.instance,e,n.defaults({__related:o},i))}}}),t.HasMany=t.Relation.extend({collectionType:null,options:{reverseRelation:{type:"HasOne"},collectionType:t.Collection,collectionKey:!0,collectionOptions:{}},initialize:function(e){if(this.listenTo(this.instance,"relational:change:"+this.key,this.onChange),this.collectionType=this.options.collectionType,!n.isFunction(this.collectionType)||this.collectionType===t.Collection||this.collectionType.prototype instanceof t.Collection||(this.collectionType=n.result(this,"collectionType")),n.isString(this.collectionType)&&(this.collectionType=t.Relational.store.getObjectByName(this.collectionType)),this.collectionType!==t.Collection&&!(this.collectionType.prototype instanceof t.Collection))throw new Error("`collectionType` must inherit from Backbone.Collection");var i=this.findRelated(e);this.setRelated(i)},_prepareCollection:function(e){if(this.related&&this.stopListening(this.related),!(e&&e instanceof t.Collection)){var i=n.isFunction(this.options.collectionOptions)?this.options.collectionOptions(this.instance):this.options.collectionOptions;e=new this.collectionType(null,i)}if(e.model=this.relatedModel,this.options.collectionKey){var o=this.options.collectionKey===!0?this.options.reverseRelation.key:this.options.collectionKey;e[o]&&e[o]!==this.instance?t.Relational.showWarnings&&"undefined"!=typeof console&&console.warn("Relation=%o; collectionKey=%s already exists on collection=%o",this,o,this.options.collectionKey):o&&(e[o]=this.instance)}return this.listenTo(e,"relational:add",this.handleAddition).listenTo(e,"relational:remove",this.handleRemoval).listenTo(e,"relational:reset",this.handleReset),e},findRelated:function(e){var i=null;if(e=n.defaults({parse:this.options.parse},e),this.keyContents instanceof t.Collection)this._prepareCollection(this.keyContents),i=this.keyContents;else{var o=[];n.each(this.keyContents,function(t){if(t instanceof this.relatedModel)var i=t;else i=this.relatedModel.findOrCreate(t,n.extend({merge:!0},e,{create:this.options.createModels}));i&&o.push(i)},this),i=this.related instanceof t.Collection?this.related:this._prepareCollection(),i.set(o,n.defaults({merge:!1,parse:!1},e))}return this.keyIds=n.difference(this.keyIds,n.pluck(i.models,"id")),i},setKeyContents:function(e){this.keyContents=e instanceof t.Collection?e:null,this.keyIds=[],this.keyContents||!e&&0!==e||(this.keyContents=n.isArray(e)?e:[e],n.each(this.keyContents,function(e){var n=t.Relational.store.resolveIdForItem(this.relatedModel,e);(n||0===n)&&this.keyIds.push(n)},this))},onChange:function(e,i,o){o=o?n.clone(o):{},this.setKeyContents(i),this.changed=!1;var r=this.findRelated(o);if(this.setRelated(r),!o.silent){var s=this;t.Relational.eventQueue.add(function(){s.changed&&(s.instance.trigger("change:"+s.key,s.instance,s.related,o,!0),s.changed=!1)})}},handleAddition:function(e,i,o){o=o?n.clone(o):{},this.changed=!0,n.each(this.getReverseRelations(e),function(e){e.addRelated(this.instance,o)},this);var r=this;!o.silent&&t.Relational.eventQueue.add(function(){r.instance.trigger("add:"+r.key,e,r.related,o)})},handleRemoval:function(e,i,o){o=o?n.clone(o):{},this.changed=!0,n.each(this.getReverseRelations(e),function(e){e.removeRelated(this.instance,null,o)},this);var r=this;!o.silent&&t.Relational.eventQueue.add(function(){r.instance.trigger("remove:"+r.key,e,r.related,o)})},handleReset:function(e,i){var o=this;i=i?n.clone(i):{},!i.silent&&t.Relational.eventQueue.add(function(){o.instance.trigger("reset:"+o.key,o.related,i)})},tryAddRelated:function(e,t,i){var o=n.contains(this.keyIds,e.id);o&&(this.addRelated(e,i),this.keyIds=n.without(this.keyIds,e.id))},addRelated:function(e,t){var i=this;e.queue(function(){i.related&&!i.related.get(e)&&i.related.add(e,n.defaults({parse:!1},t))})},removeRelated:function(e,t,n){this.related.get(e)&&this.related.remove(e,n)}}),t.RelationalModel=t.Model.extend({relations:null,_relations:null,_isInitialized:!1,_deferProcessing:!1,_queue:null,_attributeChangeFired:!1,subModelTypeAttribute:"type",subModelTypes:null,constructor:function(e,i){if(i&&i.collection){var o=this,r=this.collection=i.collection;delete i.collection,this._deferProcessing=!0;var s=function(e){e===o&&(o._deferProcessing=!1,o.processQueue(),r.off("relational:add",s))};r.on("relational:add",s),n.defer(function(){s(o)})}t.Relational.store.processOrphanRelations(),t.Relational.store.listenTo(this,"relational:unregister",t.Relational.store.unregister),this._queue=new t.BlockingQueue,this._queue.block(),t.Relational.eventQueue.block();try{t.Model.apply(this,arguments)}finally{t.Relational.eventQueue.unblock()}},trigger:function(e){if(e.length>5&&0===e.indexOf("change")){var n=this,i=arguments;t.Relational.eventQueue.isLocked()?t.Relational.eventQueue.add(function(){var o=!0;if("change"===e)o=n.hasChanged()||n._attributeChangeFired,n._attributeChangeFired=!1;else{var r=e.slice(7),s=n.getRelation(r);s?(o=i[4]===!0,o?n.changed[r]=i[2]:s.changed||delete n.changed[r]):o&&(n._attributeChangeFired=!0)}o&&t.Model.prototype.trigger.apply(n,i)}):t.Model.prototype.trigger.apply(n,i)}else"destroy"===e?(t.Model.prototype.trigger.apply(this,arguments),t.Relational.store.unregister(this)):t.Model.prototype.trigger.apply(this,arguments);
return this},initializeRelations:function(e){this.acquire(),this._relations={},n.each(this.relations||[],function(n){t.Relational.store.initializeRelation(this,n,e)},this),this._isInitialized=!0,this.release(),this.processQueue()},updateRelations:function(e,t){this._isInitialized&&!this.isLocked()&&n.each(this._relations,function(n){if(!e||n.keySource in e||n.key in e){var i=this.attributes[n.keySource]||this.attributes[n.key],o=e&&(e[n.keySource]||e[n.key]);(n.related!==i||null===i&&null===o)&&this.trigger("relational:change:"+n.key,this,i,t||{})}n.keySource!==n.key&&delete this.attributes[n.keySource]},this)},queue:function(e){this._queue.add(e)},processQueue:function(){this._isInitialized&&!this._deferProcessing&&this._queue.isBlocked()&&this._queue.unblock()},getRelation:function(e){return this._relations[e]},getRelations:function(){return n.values(this._relations)},fetchRelated:function(e,i,o){i=n.extend({update:!0,remove:!1},i);var r,s,a=[],l=this.getRelation(e),u=l&&(l.keyIds&&l.keyIds.slice(0)||(l.keyId||0===l.keyId?[l.keyId]:[]));if(o&&(r=l.related instanceof t.Collection?l.related.models:[l.related],n.each(r,function(e){(e.id||0===e.id)&&u.push(e.id)})),u&&u.length){var c=[];if(r=n.map(u,function(e){var t=l.relatedModel.findModel(e);if(!t){var n={};n[l.relatedModel.prototype.idAttribute]=e,t=l.relatedModel.findOrCreate(n,i),c.push(t)}return t},this),l.related instanceof t.Collection&&n.isFunction(l.related.url)&&(s=l.related.url(r)),s&&s!==l.related.url()){var d=n.defaults({error:function(){var e=arguments;n.each(c,function(t){t.trigger("destroy",t,t.collection,i),i.error&&i.error.apply(t,e)})},url:s},i);a=[l.related.fetch(d)]}else a=n.map(r,function(e){var t=n.defaults({error:function(){n.contains(c,e)&&(e.trigger("destroy",e,e.collection,i),i.error&&i.error.apply(e,arguments))}},i);return e.fetch(t)},this)}return a},get:function(e){var i=t.Model.prototype.get.call(this,e);if(!this.dotNotation||-1===e.indexOf("."))return i;var o=e.split("."),r=n.reduce(o,function(e,i){if(n.isNull(e)||n.isUndefined(e))return void 0;if(e instanceof t.Model)return t.Model.prototype.get.call(e,i);if(e instanceof t.Collection)return t.Collection.prototype.at.call(e,i);throw new Error("Attribute must be an instanceof Backbone.Model or Backbone.Collection. Is: "+e+", currentSplit: "+i)},this);if(void 0!==i&&void 0!==r)throw new Error("Ambiguous result for '"+e+"'. direct result: "+i+", dotNotation: "+r);return i||r},set:function(e,i,o){t.Relational.eventQueue.block();var r;n.isObject(e)||null==e?(r=e,o=i):(r={},r[e]=i);try{var s=this.id,a=r&&this.idAttribute in r&&r[this.idAttribute];t.Relational.store.checkId(this,a);var l=t.Model.prototype.set.apply(this,arguments);this._isInitialized||this.isLocked()?a&&a!==s&&t.Relational.store.update(this):(this.constructor.initializeModelHierarchy(),(a||0===a)&&t.Relational.store.register(this),this.initializeRelations(o)),r&&this.updateRelations(r,o)}finally{t.Relational.eventQueue.unblock()}return l},clone:function(){var e=n.clone(this.attributes);return n.isUndefined(e[this.idAttribute])||(e[this.idAttribute]=null),n.each(this.getRelations(),function(t){delete e[t.key]}),new this.constructor(e)},toJSON:function(e){if(this.isLocked())return this.id;this.acquire();var i=t.Model.prototype.toJSON.call(this,e);return!this.constructor._superModel||this.constructor._subModelTypeAttribute in i||(i[this.constructor._subModelTypeAttribute]=this.constructor._subModelTypeValue),n.each(this._relations,function(o){var r=i[o.key],s=o.options.includeInJSON,a=null;s===!0?r&&n.isFunction(r.toJSON)&&(a=r.toJSON(e)):n.isString(s)?(r instanceof t.Collection?a=r.pluck(s):r instanceof t.Model&&(a=r.get(s)),s===o.relatedModel.prototype.idAttribute&&(o instanceof t.HasMany?a=a.concat(o.keyIds):o instanceof t.HasOne&&(a=a||o.keyId,a||n.isObject(o.keyContents)||(a=o.keyContents||null)))):n.isArray(s)?r instanceof t.Collection?(a=[],r.each(function(e){var t={};n.each(s,function(n){t[n]=e.get(n)}),a.push(t)})):r instanceof t.Model&&(a={},n.each(s,function(e){a[e]=r.get(e)})):delete i[o.key],s&&(i[o.keyDestination]=a),o.keyDestination!==o.key&&delete i[o.key]}),this.release(),i}},{setup:function(){return this.prototype.relations=(this.prototype.relations||[]).slice(0),this._subModels={},this._superModel=null,this.prototype.hasOwnProperty("subModelTypes")?t.Relational.store.addSubModels(this.prototype.subModelTypes,this):this.prototype.subModelTypes=null,n.each(this.prototype.relations||[],function(e){if(e.model||(e.model=this),e.reverseRelation&&e.model===this){var i=!0;if(n.isString(e.relatedModel)){var o=t.Relational.store.getObjectByName(e.relatedModel);i=o&&o.prototype instanceof t.RelationalModel}i?t.Relational.store.initializeRelation(null,e):n.isString(e.relatedModel)&&t.Relational.store.addOrphanRelation(e)}},this),this},build:function(e,t){this.initializeModelHierarchy();var n=this._findSubModelType(this,e)||this;return new n(e,t)},_findSubModelType:function(e,t){if(e._subModels&&e.prototype.subModelTypeAttribute in t){var n=t[e.prototype.subModelTypeAttribute],i=e._subModels[n];if(i)return i;for(n in e._subModels)if(i=this._findSubModelType(e._subModels[n],t))return i}return null},initializeModelHierarchy:function(){if(this.inheritRelations(),this.prototype.subModelTypes){var e=n.keys(this._subModels),i=n.omit(this.prototype.subModelTypes,e);n.each(i,function(e){var n=t.Relational.store.getObjectByName(e);n&&n.initializeModelHierarchy()})}},inheritRelations:function(){if(n.isUndefined(this._superModel)||n.isNull(this._superModel))if(t.Relational.store.setupSuperModel(this),this._superModel){if(this._superModel.inheritRelations(),this._superModel.prototype.relations){var e=n.filter(this._superModel.prototype.relations||[],function(e){return!n.any(this.prototype.relations||[],function(t){return e.relatedModel===t.relatedModel&&e.key===t.key},this)},this);this.prototype.relations=e.concat(this.prototype.relations)}}else this._superModel=!1},findOrCreate:function(e,t){t||(t={});var i=n.isObject(e)&&t.parse&&this.prototype.parse?this.prototype.parse(n.clone(e)):e,o=this.findModel(i);return n.isObject(e)&&(o&&t.merge!==!1?(delete t.collection,delete t.url,o.set(i,t)):o||t.create===!1||(o=this.build(i,n.defaults({parse:!1},t)))),o},find:function(e,t){return t||(t={}),t.create=!1,this.findOrCreate(e,t)},findModel:function(e){return t.Relational.store.find(this,e)}}),n.extend(t.RelationalModel.prototype,t.Semaphore),t.Collection.prototype.__prepareModel=t.Collection.prototype._prepareModel,t.Collection.prototype._prepareModel=function(e,i){var o;return e instanceof t.Model?(e.collection||(e.collection=this),o=e):(i=i?n.clone(i):{},i.collection=this,o="undefined"!=typeof this.model.findOrCreate?this.model.findOrCreate(e,i):new this.model(e,i),o&&o.validationError&&(this.trigger("invalid",this,e,i),o=!1)),o};var i=t.Collection.prototype.__set=t.Collection.prototype.set;t.Collection.prototype.set=function(e,o){if(!(this.model.prototype instanceof t.RelationalModel))return i.apply(this,arguments);o&&o.parse&&(e=this.parse(e,o));var r=!n.isArray(e),s=[],a=[];e=r?e?[e]:[]:n.clone(e),n.each(e,function(e){e instanceof t.Model||(e=t.Collection.prototype._prepareModel.call(this,e,o)),e&&(a.push(e),this.get(e)||this.get(e.cid)?null!=e.id&&(this._byId[e.id]=e):s.push(e))},this),a=r?a.length?a[0]:null:a;var l=i.call(this,a,n.defaults({parse:!1},o));return n.each(s,function(e){(this.get(e)||this.get(e.cid))&&this.trigger("relational:add",e,this,o)},this),l};var o=t.Collection.prototype.__remove=t.Collection.prototype.remove;t.Collection.prototype.remove=function(e,i){if(!(this.model.prototype instanceof t.RelationalModel))return o.apply(this,arguments);var r=!n.isArray(e),s=[];e=r?e?[e]:[]:n.clone(e),i||(i={}),n.each(e,function(e){e=this.get(e)||e&&this.get(e.cid),e&&s.push(e)},this);var a=o.call(this,r?s.length?s[0]:null:s,i);return n.each(s,function(e){this.trigger("relational:remove",e,this,i)},this),a};var r=t.Collection.prototype.__reset=t.Collection.prototype.reset;t.Collection.prototype.reset=function(e,i){i=n.extend({merge:!0},i);var o=r.call(this,e,i);return this.model.prototype instanceof t.RelationalModel&&this.trigger("relational:reset",this,i),o};var s=t.Collection.prototype.__sort=t.Collection.prototype.sort;t.Collection.prototype.sort=function(e){var n=s.call(this,e);return this.model.prototype instanceof t.RelationalModel&&this.trigger("relational:reset",this,e),n};var a=t.Collection.prototype.__trigger=t.Collection.prototype.trigger;t.Collection.prototype.trigger=function(e){if(!(this.model.prototype instanceof t.RelationalModel))return a.apply(this,arguments);if("add"===e||"remove"===e||"reset"===e||"sort"===e){var i=this,o=arguments;n.isObject(o[3])&&(o=n.toArray(o),o[3]=n.clone(o[3])),t.Relational.eventQueue.add(function(){a.apply(i,o)})}else a.apply(this,arguments);return this},t.RelationalModel.extend=function(){var e=t.Model.extend.apply(this,arguments);return e.setup(this),e}})},function(e,t,n){(function(){"use strict";var i,o,r,s,a,l,u,c,d,h,p,f=this;i=n(2),o=n(1),"undefined"!=typeof e&&e.exports&&(e.exports=o),t=o,r=o.Model,s=o.Collection,a=r.prototype,l=s.prototype,o.Associations={VERSION:"0.5.5"};var _=function(){return h},b=function(e){(!i.isString(e)||i.size(e)<1)&&(e="."),h=e,c=new RegExp("[\\"+h+"\\[\\]]+","g"),d=new RegExp("[^\\"+h+"\\[\\]]+","g")};try{Object.defineProperty(o.Associations,"SEPARATOR",{enumerable:!0,get:_,set:b})}catch(v){}o.Associations.Many=o.Many="Many",o.Associations.One=o.One="One",o.Associations.Self=o.Self="Self",o.Associations.SEPARATOR=".",o.Associations.getSeparator=_,o.Associations.setSeparator=b,o.Associations.EVENTS_BUBBLE=!0,o.Associations.EVENTS_WILDCARD=!0,o.Associations.EVENTS_NC=!0,b(),u=o.AssociatedModel=o.Associations.AssociatedModel=r.extend({relations:void 0,_proxyCalls:void 0,get:function(e){var t=a.get.call(this,e);return t?t:this._getAttr.apply(this,arguments)},set:function(e,t,n){var o,r;return i.isObject(e)||null==e?(o=e,n=t):(o={},o[e]=t),r=this._set(o,n),this._processPendingEvents(),r},_set:function(e,t){var n,o,r,s,a=this;if(!e)return this;for(n in e)if(o||(o={}),n.match(c)){var l=y(n),d=i.initial(l),h=l[l.length-1],p=this.get(d);p instanceof u&&(s=o[p.cid]||(o[p.cid]={model:p,data:{}}),s.data[h]=e[n])}else s=o[this.cid]||(o[this.cid]={model:this,data:{}}),s.data[n]=e[n];if(o)for(r in o)s=o[r],this._setAttr.call(s.model,s.data,t)||(a=!1);else a=this._setAttr.call(this,e,t);return a},_setAttr:function(e,t){var n;if(t||(t={}),t.unset)for(n in e)e[n]=void 0;return this.parents=this.parents||[],this.relations&&i.each(this.relations,function(n){var a,l,c,d,h=n.key,p=n.relatedModel,f=n.collectionType,_=n.map,b=this.attributes[h],v=b&&b.idAttribute,y=!1;if(!p||p.prototype instanceof r||(p=i.isFunction(p)?p.call(this,n,e):p),p&&i.isString(p)&&(p=p===o.Self?this.constructor:g(p)),f&&i.isString(f)&&(f=g(f)),_&&i.isString(_)&&(_=g(_)),l=n.options?i.extend({},n.options,t):t,!p&&!f)throw new Error("specify either a relatedModel or collectionType");if(e[h]){if(a=i.result(e,h),a=_?_.call(this,a,f?f:p):a,n.type===o.Many){if(f&&!f.prototype instanceof s)throw new Error("collectionType must inherit from Backbone.Collection");b?(b._deferEvents=!0,b[l.reset?"reset":"set"](a instanceof s?a.models:a,l),c=b):(y=!0,a instanceof s?c=a:(c=f?new f:this._createCollection(p),c[l.reset?"reset":"set"](a,l)))}else{if(n.type!==o.One)throw new Error("type attribute must be specified and have the values Backbone.One or Backbone.Many");if(!p)throw new Error("specify a relatedModel for Backbone.One type");if(!(p.prototype instanceof o.AssociatedModel))throw new Error("specify an AssociatedModel for Backbone.One type");c=a instanceof u?a:new p(a,l),b&&c.attributes[v]&&b.attributes[v]===c.attributes[v]?(b._deferEvents=!0,b._set(a instanceof u?a.attributes:a,l),c=b):y=!0}e[h]=c,d=c,(y||d&&!d._proxyCallback)&&(d._proxyCallback=function(){return o.Associations.EVENTS_BUBBLE&&this._bubbleEvent.call(this,h,d,arguments)},d.on("all",d._proxyCallback,this))}if(e.hasOwnProperty(h)){var m=e[h],k=this.attributes[h];m?(m.parents=m.parents||[],-1==i.indexOf(m.parents,this)&&m.parents.push(this)):k&&k.parents.length>0&&(k.parents=i.difference(k.parents,[this]),k._proxyCallback&&k.off("all",k._proxyCallback,this))}},this),a.set.call(this,e,t)},_bubbleEvent:function(e,t,n){var i,a,l=n,u=l[0].split(":"),c=u[0],d="nested-change"==l[0],f="change"===c,_=l[1],b=-1,v=t._proxyCalls,y=u[1];if(!d){if(o.Associations.EVENTS_WILDCARD&&/\[\*\]/g.test(y))return this;if(t instanceof s&&(f||y)&&(b=t.indexOf(p||_)),this instanceof r&&(p=this),y=e+(-1!==b&&(f||y)?"["+b+"]":"")+(y?h+y:""),o.Associations.EVENTS_WILDCARD&&(a=y.replace(/\[\d+\]/g,"[*]")),i=[],i.push.apply(i,l),i[0]=c+":"+y,o.Associations.EVENTS_WILDCARD&&y!==a&&(i[0]=i[0]+" "+c+":"+a),v=t._proxyCalls=v||{},this._isEventAvailable.call(this,v,y))return this;if(v[y]=!0,f&&(this._previousAttributes[e]=t._previousAttributes,this.changed[e]=t),this.trigger.apply(this,i),o.Associations.EVENTS_NC&&f&&this.get(y)!=l[2]){var g=["nested-change",y,l[1]];l[2]&&g.push(l[2]),this.trigger.apply(this,g)}return v&&y&&delete v[y],p=void 0,this}},_isEventAvailable:function(e,t){return i.find(e,function(e,n){return-1!==t.indexOf(n,t.length-n.length)})},_createCollection:function(e){var t,n=e;if(i.isString(n)&&(n=g(n)),!(n&&n.prototype instanceof u||i.isFunction(n)))throw new Error("type must inherit from Backbone.AssociatedModel");return t=new s,t.model=n,t},_processPendingEvents:function(){this._processedEvents||(this._processedEvents=!0,this._deferEvents=!1,i.each(this._pendingEvents,function(e){e.c.trigger.apply(e.c,e.a)}),this._pendingEvents=[],i.each(this.relations,function(e){var t=this.attributes[e.key];t&&t._processPendingEvents()},this),delete this._processedEvents)},trigger:function(){this._deferEvents?(this._pendingEvents=this._pendingEvents||[],this._pendingEvents.push({c:this,a:arguments})):a.trigger.apply(this,arguments)},toJSON:function(e){var t,n={};return n[this.idAttribute]=this.id,this.visited||(this.visited=!0,n=a.toJSON.apply(this,arguments),this.relations&&i.each(this.relations,function(o){var r=o.key,s=o.remoteKey,a=this.attributes[r],l=!o.isTransient;delete n[r],l&&(t=a&&a.toJSON?a.toJSON(e):a,n[s||r]=i.isArray(t)?i.compact(t):t)},this),delete this.visited),n},clone:function(){return new this.constructor(this.toJSON())},cleanup:function(){i.each(this.relations,function(e){var t=this.attributes[e.key];t&&(t.parents=i.difference(t.parents,[this]))},this),this.off()},_getAttr:function(e){var t,n,o=this,r=y(e);if(!(i.size(r)<1)){for(n=0;n<r.length&&(t=r[n],o);n++)o=o instanceof s?isNaN(t)?void 0:o.at(t):o.attributes[t];return o}}});var y=function(e){return""===e?[""]:i.isString(e)?e.match(d):e||[]},g=function(e){return i.reduce(e.split(h),function(e,t){return e[t]},f)},m=function(e,t,n){var o,r;return i.find(e,function(e){return o=i.find(e.relations,function(n){return e.get(n.key)===t},this),o?(r=e,!0):void 0},this),o&&o.map?o.map.call(r,n,t):n},k={};i.each(["set","remove","reset"],function(e){k[e]=s.prototype[e],l[e]=function(t){return this.model.prototype instanceof u&&this.parents&&(arguments[0]=m(this.parents,this,t)),k[e].apply(this,arguments)}}),k.trigger=l.trigger,l.trigger=function(){this._deferEvents?(this._pendingEvents=this._pendingEvents||[],this._pendingEvents.push({c:this,a:arguments})):k.trigger.apply(this,arguments)},l._processPendingEvents=u.prototype._processPendingEvents}).call(this)},function(e,t,n){var i=n(30),o=n(29),r=function(e){this.modelName=e};r.prototype=new o,r.prototype.get=function(e){return this._data[e]},r.prototype.guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)}).toUpperCase()},r.prototype.set=function(e,t){if("object"!=typeof e)this.emit("change:"+e,this._data[e],t),this.emit("change",e,this._data[e],t),this._data[e]=t;else for(var n in e)this.set(n,e[n])},r.prototype.toJSON=function(){return this._data},r.create=function(e,t){var n=function(e){this.model=n,this._data=i(!0,{},this.schema,e),this._data._id||(this._data._id=this.guid()),this.init&&this.init()};return n.prototype=new this(e),i(n.prototype,t.methods),i(n,t.statics),n.applyMixin=function(e){i(this.prototype,e.methods),i(n,e.statics)},n},e.exports=r},function(e,t,n){var i=n(30),o=function(e){this.name=e};o.prototype.forEach=function(e){var t=0;for(var n in this.items)e(this.items[n],t++)},o.prototype.all=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},o.prototype.get=function(e){return this.items[e]},o.prototype.filter=function(e){var t=[];return this.forEach(function(n){e(n)&&t.push(n)}),t},o.prototype.toJSON=function(){var e={};for(var t in this.items)e[t]=this.items[t].toJSON();return e},o.prototype.add=function(e){this.items[e.get("_id")]=e},o.prototype.remove=function(e){"string"!=typeof e&&(e=e.get("_id")),delete this.items[e]},o.create=function(e,t){var n=function(e){this.collection=n,this.items=e||{},this.model=t.model,this.init&&this.init()};return n.prototype=new this(e),i(n.prototype,t.methods),i(n,t.statics),n.applyMixin=function(e){i(this.prototype,e.methods),i(n,e.statics)},n},e.exports=o},function(e){var t=function(){this.cache={}};t.prototype.emit=function(){for(var e=Array.prototype.slice.call(arguments),t=e.shift(),n=this.cache[t],i=n?n.length:0;i--;)n[i].apply(this,e||[])},t.prototype.on=function(e,t){return this.cache[e]||(this.cache[e]=[]),this.cache[e].push(t),[e,t]},t.prototype.off=function(e){for(var t=this.cache[e[0]],n=e[1],i=t?t.length:0;i--;)t[i]===n&&t.splice(i,1)},e.exports=t},function(e){!function(t){var n=function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),i="";("string"==typeof t||"boolean"==typeof t)&&(i=t===!0?"deep":t,t=e.shift(),"defaults"==i&&(t=n({},t),i="strict"));for(var o=0,r=e.length;r>o;o++){var s=e[o];for(var a in s)"deep"==i&&"object"==typeof s[a]&&"undefined"!=typeof t[a]?n(i,t[a],s[a]):("strict"!=i||"strict"==i&&"undefined"!=typeof t[a])&&(t[a]=s[a])}return t};e.exports=n}(this)}])});
=======
(function(){var e={requires:[]};"undefined"!=typeof window&&window.require&&e.requires.push(window.require),"undefined"!=typeof t&&t&&e.requires.push(t),function(){"use strict";var t={},r={},n=function(e,t){return{}.hasOwnProperty.call(e,t)},o=function(e,t){var r,n,o=[];r=/^\.\.?(\/|$)/.test(t)?[e,t].join("/").split("/"):t.split("/");for(var i=0,s=r.length;s>i;i++)n=r[i],".."===n?o.pop():"."!==n&&""!==n&&o.push(n);return o.join("/")},i=function(e){return e.split("/").slice(0,-1).join("/")},s=function(t){var r=function(r){var n=i(t),s=o(n,r);return e.require(s,t)};return r.register=e.require.register,r.shim=e.require.shim,r},a=function(e,t){var n={id:e,exports:{}};return r[e]=n,t(n.exports,s(e),n),n.exports},l=function(e,i){var s=o(e,".");if(null==i&&(i="/"),n(r,s))return r[s].exports;if(n(t,s))return a(s,t[s]);var l=o(s,"./index");if(n(r,l))return r[l].exports;if(n(t,l))return a(l,t[l]);throw new Error('Cannot find module "'+e+'" from "'+i+'"')},u=function(e,r){if("object"==typeof e)for(var o in e)n(e,o)&&(t[o]=e[o]);else t[e]=r},c=Object.prototype.toString,d=function(e){return"[object Array]"===c.call(e)},p=function(t){if("undefined"!=typeof window){d(t)||(t=[t]);for(var r=function(t){var r;try{if(e.require(t.path))return}catch(n){}try{for(var o=0,i=e.requires.length;i>o&&!(r=e.requires[o](t.path));o++);}catch(n){}if(!r&&t.symbol){var s=t.symbol.split(".");r=window;for(var a=0,l=s.length;l>a&&(r=r[s[a]]);a++);}if(!r){if(t.optional)return;throw new Error("Missing dependency: "+t.path)}e.require.register(t.path,function(e,t,n){return n.exports=r}),t.alias&&e.require.register(t.alias,function(e,t,n){return n.exports=r})},n=0,o=t.length;o>n;n++)r(t[n])}};e.require=l,e.require.register=u,e.require.shim=p}.call(this);var t=e.require;t.register("collection-observable",function(e,t){var r,n,o,i,s,a,l=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};i=t("./kb"),a=t("underscore"),s=t("knockout"),o=0,r=-1,n=1,i.compare=function(e,t){return a.isString(e)?e.localeCompare(""+t):a.isString(t)?t.localeCompare(""+e):e===t?o:t>e?r:n},i.CollectionObservable=function(){function e(e,t){return i.ignore(function(r){return function(){var n,o,l;return!a.isUndefined(t)||e instanceof i.Collection?a.isArray(e)&&(e=new i.Collection(e)):(l=[new i.Collection,e],e=l[0],t=l[1]),t||(t={}),o=i.utils.wrappedObservable(r,s.observableArray([])),o.__kb_is_co=!0,r.in_edit=0,r.__kb||(r.__kb={}),r.__kb._onCollectionChange=a.bind(r._onCollectionChange,r),t=i.utils.collapseOptions(t),t.auto_compact&&(r.auto_compact=!0),r._comparator=s.observable(t.sort_attribute?r._attributeComparator(t.sort_attribute):t.comparator),r._filters=s.observableArray(t.filters?a.isArray(t.filters)?t.filters:t.filters?[t.filters]:void 0:[]),n=r.create_options={store:i.Store.useOptionsOrCreate(t,e,o)},r.path=t.path,n.factory=i.utils.wrappedFactory(o,r._shareOrCreateFactory(t)),n.path=i.utils.pathJoin(t.path,"models"),n.creator=n.factory.creatorForPath(null,n.path),n.creator&&(r.models_only=n.creator.models_only),i.publishMethods(o,r,["destroy","shareOptions","filters","comparator","sortAttribute","viewModelByModel","hasViewModels"]),r._collection=s.observable(e),o.collection=r.collection=s.dependentObservable({read:function(){return r._collection()},write:function(e){return i.ignore(function(){var t;if((t=r._collection())!==e)return t&&t.unbind("all",r.__kb._onCollectionChange),e&&e.bind("all",r.__kb._onCollectionChange),r._collection(e)})}}),e&&e.bind("all",r.__kb._onCollectionChange),r._mapper=s.dependentObservable(function(){var e,t,n,l,u,c,d,p;if(e=r._comparator(),l=r._filters())for(d=0,p=l.length;p>d;d++)n=l[d],s.utils.unwrapObservable(n);return t=r._collection(),r.in_edit?void 0:(o=i.utils.wrappedObservable(r),t&&(u=t.models),u&&0!==t.models.length?(u=a.filter(u,function(e){return!l.length||r._selectModel(e)}),c=e?a.map(u,function(e){return r._createViewModel(e)}).sort(e):r.models_only?l.length?u:u.slice():a.map(u,function(e){return r._createViewModel(e)})):c=[],r.in_edit++,o(c),r.in_edit--)}),o.subscribe(a.bind(r._onObservableArrayChange,r)),!i.statistics||i.statistics.register("CollectionObservable",r),o}}(this))}return e.extend=i.extend,e.prototype.destroy=function(){var e,t,r;return r=i.utils.wrappedObservable(this),t=this._collection(),t&&(t.unbind("all",this.__kb._onCollectionChange),e=r(),e.splice(0,e.length)),this.collection.dispose(),this._collection=r.collection=this.collection=null,this._mapper.dispose(),this._mapper=null,i.release(this._filters),this._filters=null,this._comparator(null),this._comparator=null,this.create_options=null,r.collection=null,i.utils.wrappedDestroy(this),!i.statistics||i.statistics.unregister("CollectionObservable",this)},e.prototype.shareOptions=function(){var e;return e=i.utils.wrappedObservable(this),{store:i.utils.wrappedStore(e),factory:i.utils.wrappedFactory(e)}},e.prototype.filters=function(e){return this._filters(e?a.isArray(e)?e:[e]:[])},e.prototype.comparator=function(e){return this._comparator(e)},e.prototype.sortAttribute=function(e){return this._comparator(e?this._attributeComparator(e):null)},e.prototype.viewModelByModel=function(e){var t;return this.models_only?null:(t=e.hasOwnProperty(e.idAttribute)?e.idAttribute:"cid",a.find(i.peek(i.utils.wrappedObservable(this)),function(r){var n;return(null!=r&&null!=(n=r.__kb)?n.object:void 0)?r.__kb.object[t]===e[t]:!1}))},e.prototype.hasViewModels=function(){return!this.models_only},e.prototype.compact=function(){return i.ignore(function(e){return function(){var t;return t=i.utils.wrappedObservable(e),i.utils.wrappedStoreIsOwned(t)?(i.utils.wrappedStore(t).clear(),e._collection.notifySubscribers(e._collection())):void 0}}(this))},e.prototype._shareOrCreateFactory=function(e){var t,r,n,o;if(t=i.utils.pathJoin(e.path,"models"),n=e.factories,(o=e.factory)&&(r=o.creatorForPath(null,t))&&(!n||n.models===r)){if(!n)return o;if(o.hasPathMappings(n,e.path))return o}return o=new i.Factory(e.factory),n&&o.addPathMappings(n,e.path),o.creatorForPath(null,t)||(e.hasOwnProperty("models_only")?e.models_only?o.addPathMapping(t,{models_only:!0}):o.addPathMapping(t,i.ViewModel):e.view_model?o.addPathMapping(t,e.view_model):e.create?o.addPathMapping(t,{create:e.create}):o.addPathMapping(t,i.ViewModel)),o},e.prototype._onCollectionChange=function(e,t){return i.ignore(function(r){return function(){var n,o,s,a;if(!r.in_edit)switch(e){case"reset":r.auto_compact?r.compact():r._collection.notifySubscribers(r._collection());break;case"sort":case"resort":r._collection.notifySubscribers(r._collection());break;case"new":case"add":if(!r._selectModel(t))return;if(s=i.utils.wrappedObservable(r),n=r._collection(),-1===n.indexOf(t))return;if(a=r.viewModelByModel(t))return;r.in_edit++,a=r._createViewModel(t),(o=r._comparator())?(s().push(a),s.sort(o)):s.splice(n.indexOf(t),0,a),r.in_edit--;break;case"remove":case"destroy":r._onModelRemove(t);break;case"change":r._selectModel(t)?(a=r.models_only?t:r.viewModelByModel(t),a?(o=r._comparator())&&(s=i.utils.wrappedObservable(r),r.in_edit++,s.sort(o),r.in_edit--):r._onCollectionChange("add",t)):r._onModelRemove(t)}}}(this))},e.prototype._onModelRemove=function(e){var t,r;return(r=this.models_only?e:this.viewModelByModel(e))?(t=i.utils.wrappedObservable(this),this.in_edit++,t.remove(r),this.in_edit--):void 0},e.prototype._onObservableArrayChange=function(e){return i.ignore(function(t){return function(){var r,n,o,s,l,u,c,d,p;if(!t.in_edit&&(t.models_only&&(!e.length||i.utils.hasModelSignature(e[0]))||!t.models_only&&(!e.length||a.isObject(e[0])&&!i.utils.hasModelSignature(e[0]))||i._throwUnexpected(t,"incorrect type passed"),l=i.utils.wrappedObservable(t),r=i.peek(t._collection),n=i.peek(t._filters).length,r)){if(c=e,t.models_only)s=a.filter(e,function(e){return!n||t._selectModel(e)});else for(!n||(c=[]),s=[],d=0,p=e.length;p>d;d++){if(u=e[d],o=i.utils.wrappedObject(u),n){if(!t._selectModel(o))continue;c.push(u)}t.create_options.store.findOrReplace(o,t.create_options.creator,u),s.push(o)}t.in_edit++,e.length===c.length||l(c),a.isEqual(r.models,s)||r.reset(s),t.in_edit--}}}(this))},e.prototype._attributeComparator=function(e){var t;return t=function(t,r){var n;return n=s.utils.unwrapObservable(e),i.compare(t.get(n),r.get(n))},this.models_only?t:function(e,r){return t(i.utils.wrappedModel(e),i.utils.wrappedModel(r))}},e.prototype._createViewModel=function(e){return this.models_only?e:this.create_options.store.findOrCreate(e,this.create_options)},e.prototype._selectModel=function(e){var t,r,n,o,s;for(r=i.peek(this._filters),n=0,o=r.length;o>n;n++)if(t=r[n],t=i.peek(t),a.isFunction(t)){if(!t(e))return!1}else if(a.isArray(t)){if(s=e.id,l.call(t,s)<0)return!1}else if(e.id!==t)return!1;return!0},e}(),i.collectionObservable=function(e,t){return new i.CollectionObservable(e,t)}}),t.register("event-watcher",function(e,t){var r,n,o,i=function(e,t){return function(){return e.apply(t,arguments)}},s=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};r=t("./kb"),o=t("underscore"),n=t("knockout"),r.EventWatcher=function(){function e(e,t,r){this._onModelUnloaded=i(this._onModelUnloaded,this),this._onModelLoaded=i(this._onModelLoaded,this),this.__kb||(this.__kb={}),this.__kb.callbacks={},this.__kb._onModelLoaded=o.bind(this._onModelLoaded,this),this.__kb._onModelUnloaded=o.bind(this._onModelUnloaded,this),r&&this.registerCallbacks(t,r),e?this.emitter(e):this.ee=null}return e.useOptionsOrCreate=function(e,t,n,o){return e.event_watcher?(e.event_watcher.emitter()!==t&&e.event_watcher.model_ref!==t&&r._throwUnexpected(this,"emitter not matching"),r.utils.wrappedEventWatcher(n,e.event_watcher).registerCallbacks(n,o)):(r.utils.wrappedEventWatcherIsOwned(n,!0),r.utils.wrappedEventWatcher(n,new r.EventWatcher(t)).registerCallbacks(n,o))},e.prototype.destroy=function(){return this.emitter(null),this.__kb.callbacks=null,r.utils.wrappedDestroy(this)},e.prototype.emitter=function(e){var t,n,o,i,s,a,l,u;if(0===arguments.length||this.ee===e)return this.ee;this.model_ref&&(this.model_ref.unbind("loaded",this.__kb._onModelLoaded),this.model_ref.unbind("unloaded",this.__kb._onModelUnloaded),this.model_ref.release(),this.model_ref=null),r.Backbone&&r.Backbone.ModelRef&&e instanceof r.Backbone.ModelRef?(this.model_ref=e,this.model_ref.retain(),this.model_ref.bind("loaded",this.__kb._onModelLoaded),this.model_ref.bind("unloaded",this.__kb._onModelUnloaded),e=this.model_ref.model()):delete this.model_ref,s=this.ee,this.ee=e,u=this.__kb.callbacks;for(n in u)for(t=u[n],s&&s.unbind(n,t.fn),e&&this.ee.bind(n,t.fn),i=t.list,a=0,l=i.length;l>a;a++)o=i[a],o.emitter&&o.emitter(this.ee);return e},e.prototype.registerCallbacks=function(e,t){var i,a,l,u,c,d,p,_;for(e||r._throwMissing(this,"obj"),t||r._throwMissing(this,"info"),u=t.event_selector?t.event_selector:"change",l=u.split(" "),p=0,_=l.length;_>p;p++)a=l[p],a&&(i=this.__kb.callbacks[a],i||(d=[],i={list:d,fn:function(){return function(e){var t,o,i;for(o=0,i=d.length;i>o;o++)if(t=d[o],t.update&&!t.rel_fn){if(e&&t.key&&e.hasChanged&&!e.hasChanged(n.utils.unwrapObservable(t.key)))continue;!r.statistics||r.statistics.addModelEvent({name:a,model:e,key:t.key,path:t.path}),t.update()}return null}}(this)},this.__kb.callbacks[a]=i,this.ee&&this.ee.bind(a,i.fn)),c=o.defaults({obj:e},t),i.list.push(c));this.ee&&(s.call(l,"change")>=0&&(c.unbind_fn=r.orm.bind(this.ee,c.key,c.update,c.path)),c.emitter(this.ee)&&c.emitter)},e.prototype.releaseCallbacks=function(e){var t,n,o,i,s,a;if(this.__kb.callbacks&&this.ee){s=this.__kb.callbacks;for(n in s){t=s[n],a=t.list;for(o in a)if(i=a[o],i.obj===e)return t.list.splice(o,1),i.unbind_fn&&(i.unbind_fn(),i.unbind_fn=null),void(!r.wasReleased(e)&&i.emitter&&i.emitter(null))}}},e.prototype._onModelLoaded=function(e){var t,n,o,i,s,a,l;this.ee=e,a=this.__kb.callbacks;for(n in a)for(t=a[n],e.bind(n,t.fn),l=t.list,i=0,s=l.length;s>i;i++)o=l[i],o.unbind_fn=r.orm.bind(e,o.key,o.update,o.path),o.emitter&&o.emitter(e)},e.prototype._onModelUnloaded=function(e){var t,r,n,o,i,s,a;this.ee=null,a=this.__kb.callbacks;for(r in a)for(t=a[r],e.unbind(r,t.fn),o=t.list,i=0,s=o.length;s>i;i++)n=o[i],n.unbind_fn&&(n.unbind_fn(),n.unbind_fn=null),n.emitter&&n.emitter(null)},e}(),r.emitterObservable=function(e,t){return new r.EventWatcher(e,t)}}),t.register("factory",function(e,t){var r,n;r=t("./kb"),n=t("underscore"),r.Factory=function(){function e(e){this.parent_factory=e,this.paths={}}return e.useOptionsOrCreate=function(e,t,n){var o;return e.factory&&(!e.factories||e.factories&&e.factory.hasPathMappings(e.factories,n))?r.utils.wrappedFactory(t,e.factory):(o=r.utils.wrappedFactory(t,new r.Factory(e.factory)),e.factories&&o.addPathMappings(e.factories,n),o)},e.prototype.hasPath=function(e){return this.paths.hasOwnProperty(e)||this.parent_factory&&this.parent_factory.hasPath(e)},e.prototype.addPathMapping=function(e,t){return this.paths[e]=t},e.prototype.addPathMappings=function(e,t){var n,o;for(o in e)n=e[o],this.paths[r.utils.pathJoin(t,o)]=n},e.prototype.hasPathMappings=function(e,t){var n,o,i,s;n=!0;for(s in e)o=e[s],n&=(i=this.creatorForPath(null,r.utils.pathJoin(t,s)))&&o===i;return n},e.prototype.creatorForPath=function(e,t){var r;return(r=this.paths[t])?r.view_model?r.view_model:r:this.parent_factory&&(r=this.parent_factory.creatorForPath(e,t))?r:null},e}()}),t.register("index",function(e,t,r){var n,o,i,s,a,l,u,c,d,p,_,f,b;for(this.Parse&&(this.Backbone=this.Parse,this._=this.Parse._),"undefined"!=typeof window&&null!==window&&t.shim&&t.shim([{symbol:"_",path:"lodash",alias:"underscore",optional:!0},{symbol:"_",path:"underscore"},{symbol:"Backbone",path:"backbone"},{symbol:"ko",path:"knockout"}]),r.exports=s=t("./kb"),n=this.Parse?s.Parse=this.Parse:s.Backbone=t("backbone"),s.Collection=n.Collection,s.Model=n.Object||n.Model,s.Events=n.Events,s._=t("underscore"),s.ko=t("knockout"),_=["./utils","./event-watcher","./store","./factory","./observable","./view-model","./collection-observable","./orm","./inject"],a=0,c=_.length;c>a;a++)o=_[a],t(o);for(f=["./default-observable","./formatted-observable","./localized-observable","./statistics","./triggered-observable","./validation"],l=0,d=f.length;d>l;l++){o=f[l];try{t(o)}catch(h){i=h}}for(s.modules={},b=["underscore","backbone","knockout"],u=0,p=b.length;p>u;u++)o=b[u],s.modules[o]=t(o)}),t.register("inject",function(e,t){var r,n,o,i,s;r=t("./kb"),i=t("underscore"),n=t("knockout"),r.RECUSIVE_AUTO_INJECT=!0,n.bindingHandlers.inject={init:function(e,t,o,i){return r.Inject.inject(n.utils.unwrapObservable(t()),i,e,t,o)}},r.Inject=function(){function e(){}return e.inject=function(e,t,o,s,a,l){var u,c,d;return u=function(e){var n,u,c;if(i.isFunction(e))t=new e(t,o,s,a),r.releaseOnNodeRemove(t,o);else{e.view_model&&(t=new e.view_model(t,o,s,a),r.releaseOnNodeRemove(t,o));for(n in e)c=e[n],"view_model"!==n&&("create"===n?c(t,o,s,a):i.isObject(c)&&!i.isFunction(c)?(u=l||c&&c.create?{}:t,t[n]=r.Inject.inject(c,u,o,s,a,!0)):t[n]=c)}return t},l?u(e):(c=(d=n.dependentObservable(function(){return u(e)}))(),d.dispose(),c)},e.injectViewModels=function(e){var t,n,o,s,a,l,u,c,d,p;for(c=[],l=function(e){var t,r,n,o,s;for(e.__kb_injected||e.attributes&&(t=i.find(e.attributes,function(e){return"kb-inject"===e.name}))&&(e.__kb_injected=!0,c.push({el:e,view_model:{},binding:t.value})),s=e.childNodes,n=0,o=s.length;o>n;n++)r=s[n],l(r)},e||"undefined"==typeof document||null===document||(e=document),l(e),d=0,p=c.length;p>d;d++)n=c[d],(a=n.binding)&&(a.search(/[:]/)<0||(a="{"+a+"}"),s=new Function("","return ( "+a+" )")(),s||(s={}),!s.options||(u=s.options,delete s.options),u||(u={}),n.view_model=r.Inject.inject(s,n.view_model,n.el,null,null,!0),t=n.view_model.afterBinding||u.afterBinding,o=n.view_model.beforeBinding||u.beforeBinding),o&&o(n.view_model,n.el,u),r.applyBindings(n.view_model,n.el,u),t&&t(n.view_model,n.el,u);return c},e}(),s=n.applyBindings,n.applyBindings=function(e,t){var n;return n=r.RECUSIVE_AUTO_INJECT?r.injectViewModels(t):[],n.length?void 0:s.apply(this,arguments)},r.injectViewModels=r.Inject.injectViewModels,"undefined"!=typeof document&&null!==document&&(this.$?this.$(function(){return r.injectViewModels()}):(o=function(){return"complete"!==document.readyState?setTimeout(o,0):r.injectViewModels()})())}),t.register("kb",function(e,t,r){var n,o,i,s;s=t("underscore"),i=t("knockout"),n=function(e,t){var r,n;for(r in t)n=t[r],e[r]=n;return e};var a=function(){},l=function(e,t,r){var o;return o=t&&t.hasOwnProperty("constructor")?t.constructor:function(){e.apply(this,arguments)},n(o,e),a.prototype=e.prototype,o.prototype=new a,t&&n(o.prototype,t),r&&n(o,r),o.prototype.constructor=o,o.__super__=e.prototype,o},u=function(e,t){var r=l(this,e,t);return r.extend=this.extend,r};r.exports=o=function(){function e(){}var t;return e.VERSION="0.18.6",e.TYPE_UNKNOWN=0,e.TYPE_SIMPLE=1,e.TYPE_ARRAY=2,e.TYPE_MODEL=3,e.TYPE_COLLECTION=4,e.wasReleased=function(e){return!e||e.__kb_released},e.isReleaseable=function(t,r){var n,o;if(null==r&&(r=0),!t||t!==Object(t)||t.__kb_released)return!1;if(i.isObservable(t)||t instanceof e.ViewModel)return!0;if("function"==typeof t||t instanceof e.Model||t instanceof e.Collection)return!1;if("function"==typeof t.dispose||"function"==typeof t.destroy||"function"==typeof t.release)return!0;if(1>r)for(n in t)if(o=t[n],"__kb"!==n&&e.isReleaseable(o,r+1))return!0;return!1},e.release=function(t){var r,n,o;if(e.isReleaseable(t))if(s.isArray(t))for(n in t)o=t[n],e.isReleaseable(o)&&(t[n]=null,e.release(o));else if(t.__kb_released=!0,i.isObservable(t)&&s.isArray(r=e.peek(t))){if(t.__kb_is_co||t.__kb_is_o&&t.valueType()===e.TYPE_COLLECTION)t.destroy?t.destroy():t.dispose&&t.dispose();else if(r.length)for(n in r)o=r[n],e.isReleaseable(o)&&(r[n]=null,e.release(o))}else"function"==typeof t.release?t.release():"function"==typeof t.destroy?t.destroy():"function"==typeof t.dispose?t.dispose():i.isObservable(t)||this.releaseKeys(t)},e.releaseKeys=function(t){var r,n;for(r in t)n=t[r],"__kb"!==r&&e.isReleaseable(n)&&(t[r]=null,e.release(n))},e.releaseOnNodeRemove=function(t,r){return t||e._throwUnexpected(this,"missing view model"),r||e._throwUnexpected(this,"missing node"),i.utils.domNodeDisposal.addDisposeCallback(r,function(){return e.release(t)})},e.renderTemplate=function(t,r,n){var o,s;return null==n&&(n={}),"undefined"==typeof document||null===document?"undefined"!=typeof console&&null!==console?console.log("renderTemplate: document is undefined"):void 0:(o=document.createElement("div"),s=i.renderTemplate(t,r,n,o,"replaceChildren"),1===o.children.length&&(o=o.children[0]),e.releaseOnNodeRemove(r,o),s.dispose(),r.afterRender&&!n.afterRender&&r.afterRender(o),o)},e.applyBindings=function(t,r){return i.applyBindings(t,r),e.releaseOnNodeRemove(t,r)},e.getValue=function(t,r,n){return t?s.isFunction(t[r])&&e.orm.useFunction(t,r)?t[r]():n?t.get.apply(t,s.map([r].concat(n),function(t){return e.peek(t)})):t.get(r):void 0},e.setValue=function(t,r,n){var o;if(t)return s.isFunction(t[r])&&e.orm.useFunction(t,r)?t[r](n):((o={})[r]=n,t.set(o))},e.ignore=(null!=(t=i.dependencyDetection)?t.ignore:void 0)||function(e,t,r){var n;return n=null,i.dependentObservable(function(){return n=e.apply(t,r||[])}).dispose(),n},e.extend=u,e._throwMissing=function(e,t){throw""+(s.isString(e)?e:e.constructor.name)+": "+t+" is missing"},e._throwUnexpected=function(e,t){throw""+(s.isString(e)?e:e.constructor.name)+": "+t+" is unexpected"},e.publishMethods=function(t,r,n){var o,i,s;for(i=0,s=n.length;s>i;i++)o=n[i],t[o]=e._.bind(r[o],r)},e.peek=function(t){return i.isObservable(t)?t.peek?t.peek():e.ignore(function(){return t()}):t},e}()}),t.register("observable",function(e,t){var r,n,o;r=t("./kb"),o=t("underscore"),n=t("knockout"),r.Observable=function(){function e(e,t,i){return this._vm=null!=i?i:{},r.ignore(function(i){return function(){var s,a,l;return t||r._throwMissing(i,"options"),s=i.create_options=o.isString(t)||n.isObservable(t)?{key:t}:r.utils.collapseOptions(t),i.key=s.key,delete s.key,i.key||r._throwMissing(i,"key"),!s.args||(i.args=s.args,delete s.args),!s.read||(i.read=s.read,delete s.read),!s.write||(i.write=s.write,delete s.write),a=s.event_watcher,delete s.event_watcher,i._vo=n.observable(null),i._model=n.observable(),l=r.utils.wrappedObservable(i,n.dependentObservable({read:function(){var e,t,s,a,l,u;for(l=i._model(),u=t=[i.key].concat(i.args||[]),s=0,a=u.length;a>s;s++)e=u[s],n.utils.unwrapObservable(e);return i.read?i.update(i.read.apply(i._vm,t)):o.isUndefined(l)||r.ignore(function(){return i.update(r.getValue(l,r.peek(i.key),i.args))}),n.utils.unwrapObservable(i._vo())},write:function(e){return r.ignore(function(){var t,n;return t=r.utils.unwrapModels(e),n=r.peek(i._model),i.write?(i.write.call(i._vm,t),e=r.getValue(n,r.peek(i.key),i.args)):n&&r.setValue(n,r.peek(i.key),t),i.update(e)})},owner:i._vm})),l.__kb_is_o=!0,s.store=r.utils.wrappedStore(l,s.store),s.path=r.utils.pathJoin(s.path,i.key),s.factories&&("function"==typeof s.factories||s.factories.create)?(s.factory=r.utils.wrappedFactory(l,new r.Factory(s.factory)),s.factory.addPathMapping(s.path,s.factories)):s.factory=r.Factory.useOptionsOrCreate(s,l,s.path),delete s.factories,r.publishMethods(l,i,["value","valueType","destroy"]),l.model=i.model=n.dependentObservable({read:function(){return n.utils.unwrapObservable(i._model)},write:function(e){return r.ignore(function(){var t;if(!i.__kb_released&&r.peek(i._model)!==e)return t=r.getValue(e,r.peek(i.key),i.args),i._model(e),e?o.isUndefined(t)?void 0:i.update(t):i.update(null)})}}),r.EventWatcher.useOptionsOrCreate({event_watcher:a},e,i,{emitter:i.model,update:o.bind(i.update,i),key:i.key,path:s.path}),i.__kb_value||i.update(),r.LocalizedObservable&&s.localizer&&(l=new s.localizer(l),delete s.localizer),r.DefaultObservable&&s.hasOwnProperty("default")&&(l=r.defaultObservable(l,s["default"]),delete s["default"]),l}}(this))}return e.prototype.destroy=function(){var e;return e=r.utils.wrappedObservable(this),this.__kb_released=!0,r.release(this.__kb_value),this.__kb_value=null,this.model.dispose(),this.model=e.model=null,r.utils.wrappedDestroy(this)},e.prototype.value=function(){return this.__kb_value},e.prototype.valueType=function(){var e;return e=r.getValue(r.peek(this._model),r.peek(this.key)),this.value_type||this._updateValueObservable(e),this.value_type},e.prototype.update=function(e){var t,n;if(!this.__kb_released){if(arguments.length||(e=r.getValue(r.peek(this._model),r.peek(this.key))),void 0!==e||(e=null),t=r.utils.valueType(e),(!this.__kb_value||this.__kb_value.__kb_released||this.__kb_value.__kb_null&&e)&&(this.__kb_value=void 0,this.value_type=void 0),n=this.__kb_value,o.isUndefined(this.value_type)||this.value_type!==t&&t!==r.TYPE_UNKNOWN)return this.value_type===r.TYPE_COLLECTION&&t===r.TYPE_ARRAY?n(e):this._updateValueObservable(e);if(this.value_type===r.TYPE_MODEL){if("function"==typeof n.model){if(n.model()!==e)return n.model(e)}else if(r.utils.wrappedObject(n)!==e)return this._updateValueObservable(e)}else if(this.value_type===r.TYPE_COLLECTION){if(n.collection()!==e)return n.collection(e)}else if(n()!==e)return n(e)}},e.prototype._updateValueObservable=function(e){var t,i,s,a;return t=this.create_options,t.creator=r.utils.inferCreator(e,t.factory,t.path,r.peek(this._model),this.key),this.value_type=r.TYPE_UNKNOWN,i=t.creator,s=this.__kb_value,this.__kb_value=void 0,s&&r.release(s),i?t.store?a=t.store.findOrCreate(e,t):i.models_only?(a=e,this.value_type=r.TYPE_SIMPLE):a=i.create?i.create(e,t):new i(e,t):o.isArray(e)?(this.value_type=r.TYPE_ARRAY,a=n.observableArray(e)):(this.value_type=r.TYPE_SIMPLE,a=n.observable(e)),this.value_type===r.TYPE_UNKNOWN&&(n.isObservable(a)?this.value_type=a.__kb_is_co?r.TYPE_COLLECTION:r.TYPE_SIMPLE:(this.value_type=r.TYPE_MODEL,"function"!=typeof a.model&&r.utils.wrappedObject(a,e))),this.__kb_value=a,this._vo(a)},e}(),r.observable=function(e,t,n){return new r.Observable(e,t,n)}}),t.register("orm",function(e,t){var r,n,o,i,s,a;s=t("./kb"),a=t("underscore"),r=function(){function e(){this.adapters=[]}return e.prototype.initialize=function(){return this.adapters=a.select(this.adapters,function(e){return e.isAvailable()}),this.initialized=!0},e.prototype.addAdapter=function(e){return this.adapters.push(e),this.initialized=!1},e.prototype.keys=function(){return this._call("keys",arguments)},e.prototype.bind=function(){return this._call("bind",arguments)},e.prototype.useFunction=function(){return this._call("useFunction",arguments)},e.prototype._call=function(e,t){var r,n,o,i,s;if(this.adapters.length)for(this.initialized||this.initialize(),s=this.adapters,o=0,i=s.length;i>o;o++)if(r=s[o],r[e]&&(n=r[e].apply(r,t)))return n},e}(),s.orm=new r,o=function(){function e(){}return e.prototype.isAvailable=function(){var e,r;try{(null!=(e=s.Backbone)?e.RelationalModel:void 0)||("function"==typeof t?t("backbone-relational"):void 0)}catch(n){}return!!(null!=(r=s.Backbone)?r.RelationalModel:void 0)},e.prototype.relationType=function(e,t){var r;return e instanceof s.Backbone.RelationalModel&&(r=a.find(e.getRelations(),function(e){return e.key===t}))?r.collectionType||a.isArray(r.keyContents)?s.TYPE_COLLECTION:s.TYPE_MODEL:null},e.prototype.bind=function(e,t,r,n){var o,i,a,l,u,c;if(!(l=this.relationType(e,t)))return null;if(a=function(e){return!s.statistics||s.statistics.addModelEvent({name:"update (relational)",model:e,key:t,path:n}),r()},i=Backbone.Relation.prototype.sanitizeOptions?["update","add","remove"]:["change","add","remove"],l===s.TYPE_COLLECTION)for(u=0,c=i.length;c>u;u++)o=i[u],e.bind(""+o+":"+t,a);else e.bind(""+i[0]+":"+t,a);return function(){var r,n;if(l===s.TYPE_COLLECTION)for(r=0,n=i.length;n>r;r++)o=i[r],e.unbind(""+o+":"+t,a);else e.unbind(""+i[0]+":"+t,a)}},e}(),s.orm.addAdapter(new o),n=function(){function e(){}return e.prototype.isAvailable=function(){var e,r;try{(null!=(e=s.Backbone)?e.AssociatedModel:void 0)||("function"==typeof t?t("backbone-associations"):void 0)}catch(n){}return!!(null!=(r=s.Backbone)?r.AssociatedModel:void 0)},e.prototype.keys=function(e){return e instanceof s.Backbone.AssociatedModel?a.map(e.relations,function(e){return e.key}):null},e.prototype.relationType=function(e,t){var r;return e instanceof s.Backbone.AssociatedModel&&(r=a.find(e.relations,function(e){return e.key===t}))?"Many"===r.type?s.TYPE_COLLECTION:s.TYPE_MODEL:null},e}(),s.orm.addAdapter(new n),i=function(){function e(){}return e.prototype.isAvailable=function(){try{("undefined"!=typeof window&&null!==window?window.Supermodel:void 0)||("function"==typeof t?t("supermodel"):void 0)}catch(e){}return!!("undefined"!=typeof window&&null!==window?window.Supermodel:void 0)},e.prototype.keys=function(e){return e instanceof Supermodel.Model?a.keys(e.constructor.associations()):null},e.prototype.relationType=function(e,t){var r;return e instanceof Supermodel.Model&&(r=e.constructor.associations()[t])?r.add?s.TYPE_COLLECTION:s.TYPE_MODEL:null},e.prototype.bind=function(e,t,r,n){var o,i;return(i=this.relationType(e,t))?(o=function(e,o){var i,a;return!s.statistics||s.statistics.addModelEvent({name:"update (supermodel)",model:e,key:t,path:n}),a=e.constructor.associations()[t],i=e[a.store],e[a.store]=o,r(o),e[a.store]=i},i===s.TYPE_MODEL?(e.bind("associate:"+t,o),function(){return e.unbind("associate:"+t,o)}):void 0):null},e.prototype.useFunction=function(e,t){return!!this.relationType(e,t)},e}(),s.orm.addAdapter(new i)}),t.register("store",function(e,t,r){var n,o,i;n=t("./kb"),i=t("underscore"),o=t("knockout"),r.exports=n.Store=function(){function e(){this.observable_records=[],this.replaced_observables=[]}return e.useOptionsOrCreate=function(e,t,r){return e.store?(e.store.register(t,r,e),n.utils.wrappedStore(r,e.store)):(n.utils.wrappedStoreIsOwned(r,!0),n.utils.wrappedStore(r,new n.Store))},e.prototype.destroy=function(){return this.clear()},e.prototype.clear=function(){var e,t,r,o;for(o=this.observable_records.splice(0,this.observable_records.length),t=0,r=o.length;r>t;t++)e=o[t],n.release(e.observable);n.release(this.replaced_observables)},e.prototype.compact=function(){var e,t,r,n,o;r=[],n=this.observable_records;for(e in n)t=n[e],(null!=(o=t.observable)?o.__kb_released:void 0)&&r.push(t);r.length&&(this.observable_records=i.difference(this.observable_records,r))},e.prototype.register=function(e,t,r){var i;if(t&&!o.isObservable(t)&&!t.__kb_is_co)return n.utils.wrappedObject(t,e),e||(t.__kb_null=!0),i=r.creator?r.creator:r.path&&r.factory?r.factory.creatorForPath(e,r.path):null,i||(i=t.constructor),this.observable_records.push({obj:e,observable:t,creator:i}),t},e.prototype.findIndex=function(e,t){var r,o,s,a;if(s=[],!e||e instanceof n.Model){a=this.observable_records;for(r in a)if(o=a[r],o.observable)if(o.observable.__kb_released)s.push(o);else if((e||o.observable.__kb_null)&&(!e||!o.observable.__kb_null&&o.obj===e)&&(o.creator===t||o.creator.create&&o.creator.create===t.create))return s.length?(this.observable_records=i.difference(this.observable_records,s),i.indexOf(this.observable_records,o)):r}return s.length&&(this.observable_records=i.difference(this.observable_records,s)),-1},e.prototype.find=function(e,t){var r;return(r=this.findIndex(e,t))<0?null:this.observable_records[r].observable},e.prototype.isRegistered=function(e){var t,r,n,o;for(o=this.observable_records,r=0,n=o.length;n>r;r++)if(t=o[r],t.observable===e)return!0;return!1},e.prototype.findOrCreate=function(e,t){var r,i;return t.store=this,t.creator||(t.creator=n.utils.inferCreator(e,t.factory,t.path)),!t.creator&&e instanceof n.Model&&(t.creator=n.ViewModel),(r=t.creator)?r.models_only?e:(r&&(i=this.find(e,r)),i?i:(i=n.ignore(function(){return function(){return i=r.create?r.create(e,t):new r(e,t),i||o.observable(null)}}(this)),o.isObservable(i)||this.isRegistered(i)||this.register(e,i,t),i)):n.utils.createFromDefaultCreator(e,t)},e.prototype.findOrReplace=function(e,t,r){var o,i;return e||n._throwUnexpected(this,"obj missing"),(o=this.findIndex(e,t))<0?this.register(e,r,{creator:t}):(i=this.observable_records[o],n.utils.wrappedObject(i.observable)===e||n._throwUnexpected(this,"different object"),i.observable!==r&&(i.observable.constructor===r.constructor||n._throwUnexpected(this,"replacing different type"),this.replaced_observables.push(i.observable),i.observable=r),r)},e}()}),t.register("utils",function(e,t){var r,n,o,i,s,a,l,u;r=t("./kb"),o=t("underscore"),n=t("knockout"),u=r._wrappedKey=function(e,t,n){return 2===arguments.length?e&&e.__kb&&e.__kb.hasOwnProperty(t)?e.__kb[t]:void 0:(e||r._throwUnexpected(this,"no obj for wrapping "+t),e.__kb||(e.__kb={}),e.__kb[t]=n,n)},i=function(e,t){return Array.prototype.splice.call(e,1,0,t),e},a=function(e,t,r){return e[t]||(e[t]=[]),o.isArray(r)||(r=[r]),e[t]=e[t].length?o.union(e[t],r):r,e},l=function(e,t,r){return e[t]||(e[t]={}),o.extend(e[t],r)},s=function(e){var t,r,n,o;for(r={},n=0,o=e.length;o>n;n++)t=e[n],r[t]={key:t};return r},r.utils=function(){function e(){}return e.wrappedObservable=function(){return u.apply(this,i(arguments,"observable"))},e.wrappedObject=function(){return u.apply(this,i(arguments,"object"))},e.wrappedModel=function(e,t){return 1===arguments.length?(t=u(e,"object"),o.isUndefined(t)?e:t):u(e,"object",t)},e.wrappedStore=function(){return u.apply(this,i(arguments,"store"))},e.wrappedStoreIsOwned=function(){return u.apply(this,i(arguments,"store_is_owned"))},e.wrappedFactory=function(){return u.apply(this,i(arguments,"factory"))},e.wrappedEventWatcher=function(){return u.apply(this,i(arguments,"event_watcher"))},e.wrappedEventWatcherIsOwned=function(){return u.apply(this,i(arguments,"event_watcher_is_owned"))},e.wrappedDestroy=function(e){var t;if(e.__kb)return e.__kb.event_watcher&&e.__kb.event_watcher.releaseCallbacks(e),t=e.__kb,e.__kb=null,t.observable&&(t.observable.destroy=t.observable.release=null,this.wrappedDestroy(t.observable),t.observable=null),t.factory=null,t.event_watcher_is_owned&&t.event_watcher.destroy(),t.event_watcher=null,t.store_is_owned&&t.store.destroy(),t.store=null
},e.valueType=function(e){return e?e.__kb_is_o?e.valueType():e.__kb_is_co||e instanceof r.Collection?r.TYPE_COLLECTION:e instanceof r.ViewModel||e instanceof r.Model?r.TYPE_MODEL:o.isArray(e)?r.TYPE_ARRAY:r.TYPE_SIMPLE:r.TYPE_UNKNOWN},e.pathJoin=function(e,t){return(e?"."!==e[e.length-1]?""+e+".":e:"")+t},e.optionsPathJoin=function(e,t){return o.defaults({path:this.pathJoin(e.path,t)},e)},e.inferCreator=function(e,t,n){var o;return t&&(o=t.creatorForPath(e,n)),o?o:e?e instanceof r.Model?r.ViewModel:e instanceof r.Collection?r.CollectionObservable:null:null},e.createFromDefaultCreator=function(e,t){return e instanceof r.Model?r.viewModel(e,t):e instanceof r.Collection?r.collectionObservable(e,t):o.isArray(e)?n.observableArray(e):n.observable(e)},e.hasModelSignature=function(e){return e&&e.attributes&&!e.models&&"function"==typeof e.get&&"function"==typeof e.trigger},e.hasCollectionSignature=function(e){return e&&e.models&&"function"==typeof e.get&&"function"==typeof e.trigger},e.collapseOptions=function(e){var t,r,n,i;for(r={},e={options:e};e.options;){i=e.options;for(t in i)switch(n=i[t],t){case"internals":case"requires":case"excludes":case"statics":a(r,t,n);break;case"keys":o.isObject(n)&&!o.isArray(n)||o.isObject(r[t])&&!o.isArray(r[t])?(o.isObject(n)||(n=[n]),o.isArray(n)&&(n=s(n)),o.isArray(r[t])&&(r[t]=s(r[t])),l(r,t,n)):a(r,t,n);break;case"factories":o.isFunction(n)?r[t]=n:l(r,t,n);break;case"static_defaults":l(r,t,n);break;case"options":break;default:r[t]=n}e=e.options}return r},e.unwrapModels=function(e){var t,n,i;if(!e)return e;if(e.__kb)return"object"in e.__kb?e.__kb.object:e;if(o.isArray(e))return o.map(e,function(e){return r.utils.unwrapModels(e)});if(o.isObject(e)&&e.constructor==={}.constructor){n={};for(t in e)i=e[t],n[t]=r.utils.unwrapModels(i);return n}return e},e}()}),t.register("view-model",function(e,t){var r,n,o;r=t("./kb"),o=t("underscore"),n=t("knockout"),r.ViewModel=function(){function e(e,t,i){return r.ignore(function(s){return function(){var a,l,u,c,d,p,_,f,b,h;if(!e||e instanceof r.Model||"function"==typeof e.get&&"function"==typeof e.bind||r._throwUnexpected(s,"not a model"),t||(t={}),i||(i={}),t=o.isArray(t)?{keys:t}:r.utils.collapseOptions(t),s.__kb||(s.__kb={}),s.__kb.vm_keys={},s.__kb.model_keys={},s.__kb.view_model=o.isUndefined(i)?s:i,!t.internals||(s.__kb.internals=t.internals),!t.excludes||(s.__kb.excludes=t.excludes),!t.statics||(s.__kb.statics=t.statics),!t.static_defaults||(s.__kb.static_defaults=t.static_defaults),r.Store.useOptionsOrCreate(t,e,s),s.__kb.path=t.path,r.Factory.useOptionsOrCreate(t,s,t.path),b=r._wrappedKey(s,"_mdl",n.observable()),s.model=n.dependentObservable({read:function(){return b(),r.utils.wrappedObject(s)},write:function(e){return r.ignore(function(){var t,n,i,a;if(r.utils.wrappedObject(s)!==e){if(s.__kb_null)return void(!e||r._throwUnexpected(s,"model set on shared null"));if(r.utils.wrappedObject(s,e),t=r.utils.wrappedEventWatcher(s),!t)return void b(e);t.emitter(e),!s.__kb.keys&&e&&e.attributes&&(n=o.keys(e.attributes),e&&(a=r.orm.keys(e))&&(n=o.union(n,a)),i=o.difference(n,o.keys(s.__kb.model_keys)),i&&s.createObservables(e,i)),b(e)}})}}),u=r.utils.wrappedEventWatcher(s,new r.EventWatcher(e,s,{emitter:s.model})),c=t.requires,s.__kb.internals&&(c=o.union(c||[],s.__kb.internals)),e&&(_=r.orm.keys(e))&&(c=o.union(c||[],_)),t.keys)if(o.isObject(t.keys)&&!o.isArray(t.keys)){d={},h=t.keys;for(f in h)p=h[f],d[o.isString(p)?p:p.key?p.key:f]=!0;s.__kb.keys=o.keys(d)}else s.__kb.keys=t.keys,c=c?o.union(c,s.__kb.keys):o.clone(s.__kb.keys);else l=u.emitter(),l&&l.attributes&&(a=o.keys(l.attributes),c=c?o.union(c,a):a);return c&&s.__kb.excludes&&(c=o.difference(c,s.__kb.excludes)),c&&s.__kb.statics&&(c=o.difference(c,s.__kb.statics)),o.isObject(t.keys)&&!o.isArray(t.keys)&&s.mapObservables(e,t.keys),o.isObject(t.requires)&&!o.isArray(t.requires)&&s.mapObservables(e,t.requires),!t.mappings||s.mapObservables(e,t.mappings),!c||s.createObservables(e,c),!s.__kb.statics||s.createObservables(e,s.__kb.statics,!0),!r.statistics||r.statistics.register("ViewModel",s),s}}(this))}return e.extend=r.extend,e.prototype.destroy=function(){var e;if(this.__kb.view_model!==this)for(e in this.__kb.vm_keys)this.__kb.view_model[e]=null;return this.__kb.view_model=null,r.releaseKeys(this),r.utils.wrappedDestroy(this),!r.statistics||r.statistics.unregister("ViewModel",this)},e.prototype.shareOptions=function(){return{store:r.utils.wrappedStore(this),factory:r.utils.wrappedFactory(this)}},e.prototype.createObservables=function(e,t,n){var i,s,a,l,u,c;for(n?a=this.__kb.static_defaults||{}:i={store:r.utils.wrappedStore(this),factory:r.utils.wrappedFactory(this),path:this.__kb.path,event_watcher:r.utils.wrappedEventWatcher(this)},u=0,c=t.length;c>u;u++)s=t[u],l=this.__kb.internals&&o.contains(this.__kb.internals,s)?"_"+s:s,this[l]||(this.__kb.vm_keys[l]=this.__kb.model_keys[s]=!0,n?e.has(l)?this[l]=this.__kb.view_model[l]=e.get(l):l in a&&(this[l]=this.__kb.view_model[l]=a[l]):(i.key=s,this[l]=this.__kb.view_model[l]=r.observable(e,i,this)))},e.prototype.mapObservables=function(e,t){var n,i,s;n={store:r.utils.wrappedStore(this),factory:r.utils.wrappedFactory(this),path:this.__kb.path,event_watcher:r.utils.wrappedEventWatcher(this)};for(s in t)i=t[s],this[s]||(i=o.isString(i)?{key:i}:o.clone(i),i.key||(i.key=s),this.__kb.vm_keys[s]=this.__kb.model_keys[i.key]=!0,this[s]=this.__kb.view_model[s]=r.observable(e,o.defaults(i,n),this))},e}(),r.viewModel=function(e,t,n){return new r.ViewModel(e,t,n)}}),"function"==typeof define&&define.amd?define(["require","underscore","backbone","knockout"],function(){return t("index")}):"object"==typeof exports?module.exports=t("index"):this.kb=t("index")}).call(this);
>>>>>>> ec263e728855d379f1e44d8b94b29b32a5379f47
