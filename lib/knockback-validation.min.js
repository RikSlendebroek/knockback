/*
  knockback-validation.js
  (c) 2011-2014 Kevin Malakoff.
  Knockback is freely distributable under the MIT license.
  See the following for full license details:
    https://github.com/kmalakoff/knockback/blob/master/LICENSE
  Dependencies: Knockout.js, Backbone.js, and Underscore.js.
    Optional dependency: Backbone.ModelRef.js.
*/
(function(){var r={requires:[]};window.require&&r.requires.push(window.require),"undefined"!=typeof n&&null!==n&&r.requires.push(n),function(){"use strict";var n={},e={},t=function(r,n){return{}.hasOwnProperty.call(r,n)},i=function(r,n){var e,t,i=[];e=/^\.\.?(\/|$)/.test(n)?[r,n].join("/").split("/"):n.split("/");for(var u=0,a=e.length;a>u;u++)t=e[u],".."===t?i.pop():"."!==t&&""!==t&&i.push(t);return i.join("/")},u=function(r){return r.split("/").slice(0,-1).join("/")},a=function(n){var e=function(e){var t=u(n),a=i(t,e);return r.require(a,n)};return e.register=r.require.register,e.shim=r.require.shim,e},o=function(r,n){var t={id:r,exports:{}};return e[r]=t,n(t.exports,a(r),t),t.exports},l=function(r,u){var a=i(r,".");if(null==u&&(u="/"),t(e,a))return e[a].exports;if(t(n,a))return o(a,n[a]);var l=i(a,"./index");if(t(e,l))return e[l].exports;if(t(n,l))return o(l,n[l]);throw new Error('Cannot find module "'+r+'" from "'+u+'"')},s=function(r,e){if("object"==typeof r)for(var i in r)t(r,i)&&(n[i]=r[i]);else n[r]=e},c=Object.prototype.toString,f=function(r){return"[object Array]"===c.call(r)},d=function(n){if("undefined"!=typeof window){f(n)||(n=[n]);for(var e=function(n){var e;try{if(r.require(n.path))return}catch(t){}try{for(var i=0,u=r.requires.length;u>i&&!(e=r.requires[i](n.path));i++);}catch(t){}if(!e&&n.symbol){var a=n.symbol.split(".");e=window;for(var o=0,l=a.length;l>o&&(e=e[a[o]]);o++);}if(!e){if(n.optional)return;throw new Error("Missing dependency: "+n.path)}r.require.register(n.path,function(r,n,t){return t.exports=e}),n.alias&&r.require.register(n.alias,function(r,n,t){return t.exports=e})},t=0,i=n.length;i>t;t++)e(n[t])}};r.require=l,r.require.register=s,r.require.shim=d}.call(this);var n=r.require;n.register("index",function(r,n,e){"undefined"!=typeof window&&null!==window&&n.shim&&n.shim([{symbol:"_",path:"lodash",alias:"underscore",optional:!0},{symbol:"_",path:"underscore"},{symbol:"ko",path:"knockout"},{symbol:"kb",path:"knockback"}]),e.exports=n("./validation"),n("./validators")}),n.register("validation",function(r,n,e){var t,i,u,a,o;try{u=n("knockback")}catch(l){i=l,u=n("./kb")}o=n("underscore"),a=n("knockout"),t=function(r){return r=a.utils.unwrapObservable(r),"function"==typeof r?r.apply(null,Array.prototype.slice.call(arguments,1)):r},e.exports=u.Validation=function(){function r(){}return r}(),u.valueValidator=function(r,n,e){return null==e&&(e={}),e&&!("function"==typeof e)||(e={}),a.dependentObservable(function(){var i,u,l,s,c,f,d,p;d={$error_count:0},u=a.utils.unwrapObservable(r),!("disable"in e)||(l=t(e.disable)),!("enable"in e)||(l=!t(e.enable)),f=e.priorities||[],o.isArray(f)||(f=[f]),i=f.length+1;for(s in n)p=n[s],d[s]=!l&&t(p,u),d[s]&&(d.$error_count++,(c=o.indexOf(f,s)>=0)||(c=f.length),d.$active_error&&i>c?(d.$active_error=s,i=c):d.$active_error||(d.$active_error=s,i=c));return d.$enabled=!l,d.$disable=!!l,d.$valid=0===d.$error_count,d})},u.inputValidator=function(r,n,e){var t,i,a,l,s,c,f,d,p,b;if(null==e&&(e={}),e&&!("function"==typeof e)||(e={}),p=u.valid,t=$(n),(l=t.attr("name"))&&!o.isString(l)&&(l=null),!(i=t.attr("data-bind")))return null;if(s=new Function("sc","with(sc[0]) { return { "+i+" } }")([r]),!s||!s.value)return null;if(!s.validation_options||(o.defaults(s.validation_options,e),e=s.validation_options),i={},!p[f=t.attr("type")]||(i[f]=p[f]),!t.attr("required")||(i.required=p.required),s.validations){b=s.validations;for(a in b)d=b[a],i[a]=d}return c=u.valueValidator(s.value,i,e),!l&&!e.no_attach||(r["$"+l]=c),c},u.formValidator=function(r,n){var e,t,i,l,s,c,f,d,p,b,v,h,w;for(f={},b=[],e=$(n),(i=e.attr("name"))&&!o.isString(i)&&(i=null),(t=e.attr("data-bind"))&&(c=new Function("sc","with(sc[0]) { return { "+t+" } }")([r]),d=c.validation_options),d||(d={}),d.no_attach=!!i,w=e.find("input"),v=0,h=w.length;h>v;v++)l=w[v],(s=$(l).attr("name"))&&(p=u.inputValidator(r,l,d),!p||b.push(f[s]=p));return f.$error_count=a.dependentObservable(function(){var r,n,e;for(r=0,n=0,e=b.length;e>n;n++)p=b[n],r+=p().$error_count;return r}),f.$valid=a.dependentObservable(function(){return 0===f.$error_count()}),f.$enabled=a.dependentObservable(function(){var r,n,e;for(r=!0,n=0,e=b.length;e>n;n++)p=b[n],r&=p().$enabled;return r}),f.$disabled=a.dependentObservable(function(){return!f.$enabled()}),i&&(r["$"+i]=f),f}}),n.register("validators",function(r,n){var e,t,i,u,a,o,l;try{a=n("knockback")}catch(s){u=s,a=n("./kb")}l=n("underscore"),o=n("knockout"),i=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,e=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}$/,t=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/,a.valid={required:function(r){return!r},url:function(r){return!i.test(r)},email:function(r){return!e.test(r)},number:function(r){return!t.test(r)}},a.hasChangedFn=function(r){var n,e;return e=null,n=null,function(){var t;return e!==(t=o.utils.unwrapObservable(r))?(e=t,n=e?e.toJSON():null,!1):e&&n?!l.isEqual(e.toJSON(),n):!1}},a.minLengthFn=function(r){return function(n){return!n||n.length<r}},a.uniqueValueFn=function(r,n,e){return function(t){var i,u,a;return a=o.utils.unwrapObservable(r),u=o.utils.unwrapObservable(n),i=o.utils.unwrapObservable(e),a&&u&&i?!!l.find(i.models,function(){return function(r){return r!==a&&r.get(u)===t}}(this)):!1}},a.untilTrueFn=function(r,n,e){var t;return t=!1,e&&o.isObservable(e)&&e.subscribe(function(){return t=!1}),function(e){var i,u;return(i=o.utils.unwrapObservable(n))?(t|=!!(u=i(o.utils.unwrapObservable(e))),t?u:o.utils.unwrapObservable(r)):o.utils.unwrapObservable(r)}},a.untilFalseFn=function(r,n,e){var t;return t=!1,e&&o.isObservable(e)&&e.subscribe(function(){return t=!1}),function(e){var i,u;return(i=o.utils.unwrapObservable(n))?(t|=!(u=i(o.utils.unwrapObservable(e))),t?u:o.utils.unwrapObservable(r)):o.utils.unwrapObservable(r)}}}),"function"==typeof define&&define.amd?define(["require","knockback"],function(){return n("index")}):"object"==typeof exports?module.exports=n("index"):this["knockback-validation"]=n("index")}).call(this);